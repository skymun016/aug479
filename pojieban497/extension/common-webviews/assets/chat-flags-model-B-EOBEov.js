var Zt=Object.defineProperty;var Xe=n=>{throw TypeError(n)};var Yt=(n,e,t)=>e in n?Zt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>Yt(n,typeof e!="symbol"?e+"":e,t),Wt=(n,e,t)=>e.has(n)||Xe("Cannot "+t);var Ze=(n,e,t)=>e.has(n)?Xe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);var te=(n,e,t)=>(Wt(n,e,"access private method"),t);import{p as Qt,b as Jt,c as en,n as H,W as tn,o as S,R as nn,q as pe,r as Ye,t as fe,u as We,v as me,E as ye,w as be,x as sn,y as rn}from"./index-DaLJ_QUV.js";import{a as an}from"./async-messaging-BnYTstSc.js";import{W as f,S as on}from"./IconButtonAugment-CVWbWfwx.js";import{P as I,C as ln}from"./message-broker-D_dlQCzo.js";import{n as cn}from"./file-paths-BhRi9crS.js";var P,d;function Ae(n,e){return!(n===null||typeof n!="object"||!("$typeName"in n)||typeof n.$typeName!="string")&&(e===void 0||e.typeName===n.$typeName)}function un(){let n=0,e=0;for(let s=0;s<28;s+=7){let r=this.buf[this.pos++];if(n|=(127&r)<<s,!(128&r))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(15&t)<<28,e=(112&t)>>4,!(128&t))return this.assertBounds(),[n,e];for(let s=3;s<=31;s+=7){let r=this.buf[this.pos++];if(e|=(127&r)<<s,!(128&r))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(P||(P={})),function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"}(d||(d={}));const ae=4294967296;function Qe(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let s=0,r=0;function i(a,o){const c=Number(n.slice(a,o));r*=t,s=s*t+c,s>=ae&&(r+=s/ae|0,s%=ae)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?xt(s,r):Ce(s,r)}function Je(n,e){if({lo:n,hi:e}=function(c,u){return{lo:c>>>0,hi:u>>>0}}(n,e),e<=2097151)return String(ae*e+n);const t=16777215&(n>>>24|e<<8),s=e>>16&65535;let r=(16777215&n)+6777216*t+6710656*s,i=t+8147497*s,a=2*s;const o=1e7;return r>=o&&(i+=Math.floor(r/o),r%=o),i>=o&&(a+=Math.floor(i/o),i%=o),a.toString()+et(i)+et(r)}function Ce(n,e){return{lo:0|n,hi:0|e}}function xt(n,e){return e=~e,n?n=1+~n:e+=1,Ce(n,e)}const et=n=>{const e=String(n);return"0000000".slice(e.length)+e};function hn(){let n=this.buf[this.pos++],e=127&n;if(!(128&n))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(127&n)<<7,!(128&n))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(127&n)<<14,!(128&n))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(127&n)<<21,!(128&n))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(15&n)<<28;for(let t=5;128&n&&t<10;t++)n=this.buf[this.pos++];if(128&n)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var tt={};const v=dn();function dn(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof tt!="object"||tt.BUF_BIGINT_DISABLE!=="1")){const e=BigInt("-9223372036854775808"),t=BigInt("9223372036854775807"),s=BigInt("0"),r=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(i){const a=typeof i=="bigint"?i:BigInt(i);if(a>t||a<e)throw new Error(`invalid int64: ${i}`);return a},uParse(i){const a=typeof i=="bigint"?i:BigInt(i);if(a>r||a<s)throw new Error(`invalid uint64: ${i}`);return a},enc(i){return n.setBigInt64(0,this.parse(i),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(i){return n.setBigInt64(0,this.uParse(i),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec:(i,a)=>(n.setInt32(0,i,!0),n.setInt32(4,a,!0),n.getBigInt64(0,!0)),uDec:(i,a)=>(n.setInt32(0,i,!0),n.setInt32(4,a,!0),n.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:e=>(typeof e!="string"&&(e=e.toString()),nt(e),e),uParse:e=>(typeof e!="string"&&(e=e.toString()),st(e),e),enc:e=>(typeof e!="string"&&(e=e.toString()),nt(e),Qe(e)),uEnc:e=>(typeof e!="string"&&(e=e.toString()),st(e),Qe(e)),dec:(e,t)=>function(s,r){let i=Ce(s,r);const a=2147483648&i.hi;a&&(i=xt(i.lo,i.hi));const o=Je(i.lo,i.hi);return a?"-"+o:o}(e,t),uDec:(e,t)=>Je(e,t)}}function nt(n){if(!/^-?[0-9]+$/.test(n))throw new Error("invalid int64: "+n)}function st(n){if(!/^[0-9]+$/.test(n))throw new Error("invalid uint64: "+n)}function Y(n,e){switch(n){case d.STRING:return"";case d.BOOL:return!1;case d.DOUBLE:case d.FLOAT:return 0;case d.INT64:case d.UINT64:case d.SFIXED64:case d.FIXED64:case d.SINT64:return e?"0":v.zero;case d.BYTES:return new Uint8Array(0);default:return 0}}const $=Symbol.for("reflect unsafe local");function vt(n,e){const t=n[e.localName].case;return t===void 0?t:e.fields.find(s=>s.localName===t)}function gn(n,e){const t=e.localName;if(e.oneof)return n[e.oneof.localName].case===t;if(e.presence!=2)return n[t]!==void 0&&Object.prototype.hasOwnProperty.call(n,t);switch(e.fieldKind){case"list":return n[t].length>0;case"map":return Object.keys(n[t]).length>0;case"scalar":return!function(s,r){switch(s){case d.BOOL:return r===!1;case d.STRING:return r==="";case d.BYTES:return r instanceof Uint8Array&&!r.byteLength;default:return r==0}}(e.scalar,n[t]);case"enum":return n[t]!==e.enum.values[0].number}throw new Error("message field with implicit presence")}function Tt(n,e){if(e.oneof){const t=n[e.oneof.localName];return t.case===e.localName?t.value:void 0}return n[e.localName]}function It(n,e,t){e.oneof?n[e.oneof.localName]={case:e.localName,value:t}:n[e.localName]=t}function D(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Te(n,e){var t,s,r,i;if(D(n)&&$ in n&&"add"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const a=e,o=n.field();return a.listKind==o.listKind&&a.scalar===o.scalar&&((t=a.message)===null||t===void 0?void 0:t.typeName)===((s=o.message)===null||s===void 0?void 0:s.typeName)&&((r=a.enum)===null||r===void 0?void 0:r.typeName)===((i=o.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function Ie(n,e){var t,s,r,i;if(D(n)&&$ in n&&"has"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const a=e,o=n.field();return a.mapKey===o.mapKey&&a.mapKind==o.mapKind&&a.scalar===o.scalar&&((t=a.message)===null||t===void 0?void 0:t.typeName)===((s=o.message)===null||s===void 0?void 0:s.typeName)&&((r=a.enum)===null||r===void 0?void 0:r.typeName)===((i=o.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function Ee(n,e){return D(n)&&$ in n&&"desc"in n&&D(n.desc)&&n.desc.kind==="message"&&(e===void 0||n.desc.typeName==e.typeName)}function Mt(n){const e=n.fields[0];return Rt(n.typeName)&&e!==void 0&&e.fieldKind=="scalar"&&e.name=="value"&&e.number==1}function Rt(n){return n.startsWith("google.protobuf.")&&["DoubleValue","FloatValue","Int64Value","UInt64Value","Int32Value","UInt32Value","BoolValue","StringValue","BytesValue"].includes(n.substring(16))}const pn=999,fn=998,ne=2;function Ne(n,e){if(Ae(e,n))return e;const t=function(s){let r;if(function(i){switch(i.file.edition){case pn:return!1;case fn:return!0;default:return i.fields.some(a=>a.presence!=ne&&a.fieldKind!="message"&&!a.oneof)}}(s)){const i=it.get(s);let a,o;if(i)({prototype:a,members:o}=i);else{a={},o=new Set;for(const c of s.members)c.kind!="oneof"&&(c.fieldKind!="scalar"&&c.fieldKind!="enum"||c.presence!=ne&&(o.add(c),a[c.localName]=ke(c)));it.set(s,{prototype:a,members:o})}r=Object.create(a),r.$typeName=s.typeName;for(const c of s.members)if(!o.has(c)){if(c.kind=="field"&&(c.fieldKind=="message"||(c.fieldKind=="scalar"||c.fieldKind=="enum")&&c.presence!=ne))continue;r[c.localName]=ke(c)}}else{r={$typeName:s.typeName};for(const i of s.members)i.kind!="oneof"&&i.presence!=ne||(r[i.localName]=ke(i))}return r}(n);return e!==void 0&&function(s,r,i){for(const a of s.members){let o,c=i[a.localName];if(c!=null){if(a.kind=="oneof"){const u=vt(i,a);if(!u)continue;o=u,c=Tt(i,u)}else o=a;switch(o.fieldKind){case"message":c=$e(o,c);break;case"scalar":c=At(o,c);break;case"list":c=yn(o,c);break;case"map":c=mn(o,c)}It(r,o,c)}}}(n,t,e),t}function At(n,e){return n.scalar==d.BYTES?Fe(e):e}function mn(n,e){if(D(e)){if(n.scalar==d.BYTES)return rt(e,Fe);if(n.mapKind=="message")return rt(e,t=>$e(n,t))}return e}function yn(n,e){if(Array.isArray(e)){if(n.scalar==d.BYTES)return e.map(Fe);if(n.listKind=="message")return e.map(t=>$e(n,t))}return e}function $e(n,e){if(n.fieldKind=="message"&&!n.oneof&&Mt(n.message))return At(n.message.fields[0],e);if(D(e)){if(n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!=="google.protobuf.Value")return e;if(!Ae(e,n.message))return Ne(n.message,e)}return e}function Fe(n){return Array.isArray(n)?new Uint8Array(n):n}function rt(n,e){const t={};for(const s of Object.entries(n))t[s[0]]=e(s[1]);return t}const bn=Symbol(),it=new WeakMap;function ke(n){if(n.kind=="oneof")return{case:void 0};if(n.fieldKind=="list")return[];if(n.fieldKind=="map")return{};if(n.fieldKind=="message")return bn;const e=n.getDefaultValue();return e!==void 0?n.fieldKind=="scalar"&&n.longAsString?e.toString():e:n.fieldKind=="scalar"?Y(n.scalar,n.longAsString):n.enum.values[0].number}class z extends Error{constructor(e,t,s="FieldValueInvalidError"){super(t),this.name=s,this.field=()=>e}}const we=Symbol.for("@bufbuild/protobuf/text-encoding");function Ct(){if(globalThis[we]==null){const n=new globalThis.TextEncoder,e=new globalThis.TextDecoder;globalThis[we]={encodeUtf8:t=>n.encode(t),decodeUtf8:t=>e.decode(t),checkUtf8(t){try{return encodeURIComponent(t),!0}catch{return!1}}}}return globalThis[we]}var R;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(R||(R={}));const kn=34028234663852886e22,wn=-34028234663852886e22,_n=4294967295,Sn=2147483647,xn=-2147483648;class vn{constructor(e,t=Ct().decodeUtf8){this.decodeUtf8=t,this.varint64=un,this.uint32=hn,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,s=7&e;if(t<=0||s<0||s>5)throw new Error("illegal tag: field no "+t+" wire type "+s);return[t,s]}skip(e,t){let s=this.pos;switch(e){case R.Varint:for(;128&this.buf[this.pos++];);break;case R.Bit64:this.pos+=4;case R.Bit32:this.pos+=4;break;case R.LengthDelimited:let r=this.uint32();this.pos+=r;break;case R.StartGroup:for(;;){const[i,a]=this.tag();if(a===R.EndGroup){if(t!==void 0&&i!==t)throw new Error("invalid end group tag");break}this.skip(a,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return v.dec(...this.varint64())}uint64(){return v.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),s=-(1&e);return e=(e>>>1|(1&t)<<31)^s,t=t>>>1^s,v.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return v.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return v.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}}function at(n,e,t){const s=Pe(n,t);if(s!==!0)return new z(n,`list item #${e+1}: ${oe(n,t,s)}`)}function Pe(n,e){return n.scalar!==void 0?Et(e,n.scalar):n.enum!==void 0?n.enum.open?Number.isInteger(e):n.enum.values.some(t=>t.number===e):Ee(e,n.message)}function Et(n,e){switch(e){case d.DOUBLE:return typeof n=="number";case d.FLOAT:return typeof n=="number"&&(!(!Number.isNaN(n)&&Number.isFinite(n))||!(n>kn||n<wn)||`${n.toFixed()} out of range`);case d.INT32:case d.SFIXED32:case d.SINT32:return!(typeof n!="number"||!Number.isInteger(n))&&(!(n>Sn||n<xn)||`${n.toFixed()} out of range`);case d.FIXED32:case d.UINT32:return!(typeof n!="number"||!Number.isInteger(n))&&(!(n>_n||n<0)||`${n.toFixed()} out of range`);case d.BOOL:return typeof n=="boolean";case d.STRING:return typeof n=="string"&&(Ct().checkUtf8(n)||"invalid UTF8");case d.BYTES:return n instanceof Uint8Array;case d.INT64:case d.SFIXED64:case d.SINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return v.parse(n),!0}catch{return`${n} out of range`}return!1;case d.FIXED64:case d.UINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return v.uParse(n),!0}catch{return`${n} out of range`}return!1}}function oe(n,e,t){return t=typeof t=="string"?`: ${t}`:`, got ${le(e)}`,n.scalar!==void 0?`expected ${function(s){switch(s){case d.STRING:return"string";case d.BOOL:return"boolean";case d.INT64:case d.SINT64:case d.SFIXED64:return"bigint (int64)";case d.UINT64:case d.FIXED64:return"bigint (uint64)";case d.BYTES:return"Uint8Array";case d.DOUBLE:return"number (float64)";case d.FLOAT:return"number (float32)";case d.FIXED32:case d.UINT32:return"number (uint32)";case d.INT32:case d.SFIXED32:case d.SINT32:return"number (int32)"}}(n.scalar)}`+t:n.enum!==void 0?`expected ${n.enum.toString()}`+t:`expected ${Nt(n.message)}`+t}function le(n){switch(typeof n){case"object":return n===null?"null":n instanceof Uint8Array?`Uint8Array(${n.length})`:Array.isArray(n)?`Array(${n.length})`:Te(n)?$t(n.field()):Ie(n)?Ft(n.field()):Ee(n)?Nt(n.desc):Ae(n)?`message ${n.$typeName}`:"object";case"string":return n.length>30?"string":`"${n.split('"').join('\\"')}"`;case"boolean":case"number":return String(n);case"bigint":return String(n)+"n";default:return typeof n}}function Nt(n){return`ReflectMessage (${n.typeName})`}function $t(n){switch(n.listKind){case"message":return`ReflectList (${n.message.toString()})`;case"enum":return`ReflectList (${n.enum.toString()})`;case"scalar":return`ReflectList (${d[n.scalar]})`}}function Ft(n){switch(n.mapKind){case"message":return`ReflectMap (${d[n.mapKey]}, ${n.message.toString()})`;case"enum":return`ReflectMap (${d[n.mapKey]}, ${n.enum.toString()})`;case"scalar":return`ReflectMap (${d[n.mapKey]}, ${d[n.scalar]})`}}function De(n,e,t=!0){return new Pt(n,e,t)}class Pt{get sortedFields(){var e;return(e=this._sortedFields)!==null&&e!==void 0?e:this._sortedFields=this.desc.fields.concat().sort((t,s)=>t.number-s.number)}constructor(e,t,s=!0){this.lists=new Map,this.maps=new Map,this.check=s,this.desc=e,this.message=this[$]=t??Ne(e),this.fields=e.fields,this.oneofs=e.oneofs,this.members=e.members}findNumber(e){return this._fieldsByNumber||(this._fieldsByNumber=new Map(this.desc.fields.map(t=>[t.number,t]))),this._fieldsByNumber.get(e)}oneofCase(e){return K(this.message,e),vt(this.message,e)}isSet(e){return K(this.message,e),gn(this.message,e)}clear(e){K(this.message,e),function(t,s){const r=s.localName;if(s.oneof){const i=s.oneof.localName;t[i].case===r&&(t[i]={case:void 0})}else if(s.presence!=2)delete t[r];else switch(s.fieldKind){case"map":t[r]={};break;case"list":t[r]=[];break;case"enum":t[r]=s.enum.values[0].number;break;case"scalar":t[r]=Y(s.scalar,s.longAsString)}}(this.message,e)}get(e){K(this.message,e);const t=Tt(this.message,e);switch(e.fieldKind){case"list":let s=this.lists.get(e);return s&&s[$]===t||this.lists.set(e,s=new Tn(e,t,this.check)),s;case"map":let r=this.maps.get(e);return r&&r[$]===t||this.maps.set(e,r=new In(e,t,this.check)),r;case"message":return Be(e,t,this.check);case"scalar":return t===void 0?Y(e.scalar,!1):qe(e,t);case"enum":return t??e.enum.values[0].number}}set(e,t){if(K(this.message,e),this.check){const r=function(i,a){const o=i.fieldKind=="list"?Te(a,i):i.fieldKind=="map"?Ie(a,i):Pe(i,a);if(o===!0)return;let c;switch(i.fieldKind){case"list":c=`expected ${$t(i)}, got ${le(a)}`;break;case"map":c=`expected ${Ft(i)}, got ${le(a)}`;break;default:c=oe(i,a,o)}return new z(i,c)}(e,t);if(r)throw r}let s;s=e.fieldKind=="message"?Ue(e,t):Ie(t)||Te(t)?t[$]:Oe(e,t),It(this.message,e,s)}getUnknown(){return this.message.$unknown}setUnknown(e){this.message.$unknown=e}}function K(n,e){if(e.parent.typeName!==n.$typeName)throw new z(e,`cannot use ${e.toString()} with message ${n.$typeName}`,"ForeignFieldError")}class Tn{field(){return this._field}get size(){return this._arr.length}constructor(e,t,s){this._field=e,this._arr=this[$]=t,this.check=s}get(e){const t=this._arr[e];return t===void 0?void 0:_e(this._field,t,this.check)}set(e,t){if(e<0||e>=this._arr.length)throw new z(this._field,`list item #${e+1}: out of range`);if(this.check){const s=at(this._field,e,t);if(s)throw s}this._arr[e]=ot(this._field,t)}add(e){if(this.check){const t=at(this._field,this._arr.length,e);if(t)throw t}this._arr.push(ot(this._field,e))}clear(){this._arr.splice(0,this._arr.length)}[Symbol.iterator](){return this.values()}keys(){return this._arr.keys()}*values(){for(const e of this._arr)yield _e(this._field,e,this.check)}*entries(){for(let e=0;e<this._arr.length;e++)yield[e,_e(this._field,this._arr[e],this.check)]}}class In{constructor(e,t,s=!0){this.obj=this[$]=t??{},this.check=s,this._field=e}field(){return this._field}set(e,t){if(this.check){const s=function(r,i,a){const o=Et(i,r.mapKey);if(o!==!0)return new z(r,`invalid map key: ${oe({scalar:r.mapKey},i,o)}`);const c=Pe(r,a);return c!==!0?new z(r,`map entry ${le(i)}: ${oe(r,a,c)}`):void 0}(this._field,e,t);if(s)throw s}return this.obj[se(e)]=function(s,r){return s.mapKind=="message"?Ue(s,r):Oe(s,r)}(this._field,t),this}delete(e){const t=se(e),s=Object.prototype.hasOwnProperty.call(this.obj,t);return s&&delete this.obj[t],s}clear(){for(const e of Object.keys(this.obj))delete this.obj[e]}get(e){let t=this.obj[se(e)];return t!==void 0&&(t=Se(this._field,t,this.check)),t}has(e){return Object.prototype.hasOwnProperty.call(this.obj,se(e))}*keys(){for(const e of Object.keys(this.obj))yield lt(e,this._field.mapKey)}*entries(){for(const e of Object.entries(this.obj))yield[lt(e[0],this._field.mapKey),Se(this._field,e[1],this.check)]}[Symbol.iterator](){return this.entries()}get size(){return Object.keys(this.obj).length}*values(){for(const e of Object.values(this.obj))yield Se(this._field,e,this.check)}forEach(e,t){for(const s of this.entries())e.call(t,s[1],s[0],this)}}function Ue(n,e){return Ee(e)?Rt(e.message.$typeName)&&!n.oneof&&n.fieldKind=="message"?e.message.value:e.desc.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"?Ut(e.message):e.message:e}function Be(n,e,t){return e!==void 0&&(Mt(n.message)&&!n.oneof&&n.fieldKind=="message"?e={$typeName:n.message.typeName,value:qe(n.message.fields[0],e)}:n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"&&D(e)&&(e=Dt(e))),new Pt(n.message,e,t)}function ot(n,e){return n.listKind=="message"?Ue(n,e):Oe(n,e)}function _e(n,e,t){return n.listKind=="message"?Be(n,e,t):qe(n,e)}function Se(n,e,t){return n.mapKind=="message"?Be(n,e,t):e}function se(n){return typeof n=="string"||typeof n=="number"?n:String(n)}function lt(n,e){switch(e){case d.STRING:return n;case d.INT32:case d.FIXED32:case d.UINT32:case d.SFIXED32:case d.SINT32:{const t=Number.parseInt(n);if(Number.isFinite(t))return t;break}case d.BOOL:switch(n){case"true":return!0;case"false":return!1}break;case d.UINT64:case d.FIXED64:try{return v.uParse(n)}catch{}break;default:try{return v.parse(n)}catch{}}return n}function qe(n,e){switch(n.scalar){case d.INT64:case d.SFIXED64:case d.SINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=v.parse(e));break;case d.FIXED64:case d.UINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=v.uParse(e))}return e}function Oe(n,e){switch(n.scalar){case d.INT64:case d.SFIXED64:case d.SINT64:"longAsString"in n&&n.longAsString?e=String(e):typeof e!="string"&&typeof e!="number"||(e=v.parse(e));break;case d.FIXED64:case d.UINT64:"longAsString"in n&&n.longAsString?e=String(e):typeof e!="string"&&typeof e!="number"||(e=v.uParse(e))}return e}function Dt(n){const e={$typeName:"google.protobuf.Struct",fields:{}};if(D(n))for(const[t,s]of Object.entries(n))e.fields[t]=qt(s);return e}function Ut(n){const e={};for(const[t,s]of Object.entries(n.fields))e[t]=Bt(s);return e}function Bt(n){switch(n.kind.case){case"structValue":return Ut(n.kind.value);case"listValue":return n.kind.value.values.map(Bt);case"nullValue":case void 0:return null;default:return n.kind.value}}function qt(n){const e={$typeName:"google.protobuf.Value",kind:{case:void 0}};switch(typeof n){case"number":e.kind={case:"numberValue",value:n};break;case"string":e.kind={case:"stringValue",value:n};break;case"boolean":e.kind={case:"boolValue",value:n};break;case"object":if(n===null)e.kind={case:"nullValue",value:0};else if(Array.isArray(n)){const t={$typeName:"google.protobuf.ListValue",values:[]};if(Array.isArray(n))for(const s of n)t.values.push(qt(s));e.kind={case:"listValue",value:t}}else e.kind={case:"structValue",value:Dt(n)}}return e}const ct={readUnknownFields:!0};function Mn(n,e,t){const s=De(n,void 0,!1);return Ot(s,new vn(e),function(r){return r?Object.assign(Object.assign({},ct),r):ct}(t),!1,e.byteLength),s.message}function Ot(n,e,t,s,r){var i;const a=s?e.len:e.pos+r;let o,c;const u=(i=n.getUnknown())!==null&&i!==void 0?i:[];for(;e.pos<a&&([o,c]=e.tag(),!s||c!=R.EndGroup);){const h=n.findNumber(o);if(h)Rn(n,e,h,c,t);else{const g=e.skip(c,o);t.readUnknownFields&&u.push({no:o,wireType:c,data:g})}}if(s&&(c!=R.EndGroup||o!==r))throw new Error("invalid end group tag");u.length>0&&n.setUnknown(u)}function Rn(n,e,t,s,r){switch(t.fieldKind){case"scalar":n.set(t,L(e,t.scalar));break;case"enum":n.set(t,L(e,d.INT32));break;case"message":n.set(t,xe(e,r,t,n.get(t)));break;case"list":(function(i,a,o,c){var u;const h=o.field();if(h.listKind==="message")return void o.add(xe(i,c,h));const g=(u=h.scalar)!==null&&u!==void 0?u:d.INT32;if(!(a==R.LengthDelimited&&g!=d.STRING&&g!=d.BYTES))return void o.add(L(i,g));const m=i.uint32()+i.pos;for(;i.pos<m;)o.add(L(i,g))})(e,s,n.get(t),r);break;case"map":(function(i,a,o){const c=a.field();let u,h;const g=i.pos+i.uint32();for(;i.pos<g;){const[p]=i.tag();switch(p){case 1:u=L(i,c.mapKey);break;case 2:switch(c.mapKind){case"scalar":h=L(i,c.scalar);break;case"enum":h=i.int32();break;case"message":h=xe(i,o,c)}}}if(u===void 0&&(u=Y(c.mapKey,!1)),h===void 0)switch(c.mapKind){case"scalar":h=Y(c.scalar,!1);break;case"enum":h=c.enum.values[0].number;break;case"message":h=De(c.message,void 0,!1)}a.set(u,h)})(e,n.get(t),r)}}function xe(n,e,t,s){const r=t.delimitedEncoding,i=s??De(t.message,void 0,!1);return Ot(i,n,e,r,r?t.number:n.uint32()),i}function L(n,e){switch(e){case d.STRING:return n.string();case d.BOOL:return n.bool();case d.DOUBLE:return n.double();case d.FLOAT:return n.float();case d.INT32:return n.int32();case d.INT64:return n.int64();case d.UINT64:return n.uint64();case d.FIXED64:return n.fixed64();case d.BYTES:return n.bytes();case d.FIXED32:return n.fixed32();case d.SFIXED32:return n.sfixed32();case d.SFIXED64:return n.sfixed64();case d.SINT64:return n.sint64();case d.UINT32:return n.uint32();case d.SINT32:return n.sint32()}}function ut(n){const e=P[n];return typeof e!="string"?n.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class F extends Error{constructor(e,t=P.Unknown,s,r,i){super(function(a,o){return a.length?`[${ut(o)}] ${a}`:`[${ut(o)}]`}(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(s??{}),this.details=r??[],this.cause=i}static from(e,t=P.Unknown){return e instanceof F?e:e instanceof Error?e.name=="AbortError"?new F(e.message,P.Canceled):new F(e.message,t,void 0,void 0,e):new F(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error&&(Object.getPrototypeOf(e)===F.prototype||e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e)}findDetails(e){const t=e.kind==="message"?{getMessage:r=>r===e.typeName?e:void 0}:e,s=[];for(const r of this.details){if("desc"in r){t.getMessage(r.desc.typeName)&&s.push(Ne(r.desc,r.value));continue}const i=t.getMessage(r.type);if(i)try{s.push(Mn(i,r.value))}catch{}}return s}}var An=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(r){e[r]=n[r]&&function(i){return new Promise(function(a,o){(function(c,u,h,g){Promise.resolve(g).then(function(p){c({value:p,done:h})},u)})(a,o,(i=n[r](i)).done,i.value)})}}},W=function(n){return this instanceof W?(this.v=n,this):new W(n)},Cn=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=t.apply(n,e||[]),i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(g){return function(p){return Promise.resolve(p).then(g,u)}}),s[Symbol.asyncIterator]=function(){return this},s;function a(g,p){r[g]&&(s[g]=function(m){return new Promise(function(w,_){i.push([g,m,w,_])>1||o(g,m)})},p&&(s[g]=p(s[g])))}function o(g,p){try{(m=r[g](p)).value instanceof W?Promise.resolve(m.value.v).then(c,u):h(i[0][2],m)}catch(w){h(i[0][3],w)}var m}function c(g){o("next",g)}function u(g){o("throw",g)}function h(g,p){g(p),i.shift(),i.length&&o(i[0][0],i[0][1])}},En=function(n){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,i){e[r]=n[r]?function(a){return(t=!t)?{value:W(n[r](a)),done:!1}:i?i(a):a}:i}},Lt=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},s("next"),s("throw"),s("return"),e[Symbol.asyncIterator]=function(){return this},e);function s(r){e[r]=n[r]&&function(i){return new Promise(function(a,o){(function(c,u,h,g){Promise.resolve(g).then(function(p){c({value:p,done:h})},u)})(a,o,(i=n[r](i)).done,i.value)})}}},j=function(n){return this instanceof j?(this.v=n,this):new j(n)},Nn=function(n){var e,t;return e={},s("next"),s("throw",function(r){throw r}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(r,i){e[r]=n[r]?function(a){return(t=!t)?{value:j(n[r](a)),done:!1}:i?i(a):a}:i}},$n=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,r=t.apply(n,e||[]),i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(g){return function(p){return Promise.resolve(p).then(g,u)}}),s[Symbol.asyncIterator]=function(){return this},s;function a(g,p){r[g]&&(s[g]=function(m){return new Promise(function(w,_){i.push([g,m,w,_])>1||o(g,m)})},p&&(s[g]=p(s[g])))}function o(g,p){try{(m=r[g](p)).value instanceof j?Promise.resolve(m.value.v).then(c,u):h(i[0][2],m)}catch(w){h(i[0][3],w)}var m}function c(g){o("next",g)}function u(g){o("throw",g)}function h(g,p){g(p),i.shift(),i.length&&o(i[0][0],i[0][1])}};function Fn(n,e){return function(t,s){const r={};for(const i of t.methods){const a=s(i);a!=null&&(r[i.localName]=a)}return r}(n,t=>{switch(t.methodKind){case"unary":return function(s,r){return async function(i,a){var o,c;const u=await s.unary(r,a==null?void 0:a.signal,a==null?void 0:a.timeoutMs,a==null?void 0:a.headers,i,a==null?void 0:a.contextValues);return(o=a==null?void 0:a.onHeader)===null||o===void 0||o.call(a,u.header),(c=a==null?void 0:a.onTrailer)===null||c===void 0||c.call(a,u.trailer),u.message}}(e,t);case"server_streaming":return function(s,r){return function(i,a){return ht(s.stream(r,a==null?void 0:a.signal,a==null?void 0:a.timeoutMs,a==null?void 0:a.headers,function(o){return Cn(this,arguments,function*(){yield W(yield*En(An(o)))})}([i]),a==null?void 0:a.contextValues),a)}}(e,t);case"client_streaming":return function(s,r){return async function(i,a){var o,c,u,h,g,p;const m=await s.stream(r,a==null?void 0:a.signal,a==null?void 0:a.timeoutMs,a==null?void 0:a.headers,i,a==null?void 0:a.contextValues);let w;(g=a==null?void 0:a.onHeader)===null||g===void 0||g.call(a,m.header);let _=0;try{for(var y,N=!0,O=Lt(m.message);!(o=(y=await O.next()).done);N=!0)h=y.value,N=!1,w=h,_++}catch(ee){c={error:ee}}finally{try{N||o||!(u=O.return)||await u.call(O)}finally{if(c)throw c.error}}if(!w)throw new F("protocol error: missing response message",P.Unimplemented);if(_>1)throw new F("protocol error: received extra messages for client streaming method",P.Unimplemented);return(p=a==null?void 0:a.onTrailer)===null||p===void 0||p.call(a,m.trailer),w}}(e,t);case"bidi_streaming":return function(s,r){return function(i,a){return ht(s.stream(r,a==null?void 0:a.signal,a==null?void 0:a.timeoutMs,a==null?void 0:a.headers,i,a==null?void 0:a.contextValues),a)}}(e,t);default:return null}})}function ht(n,e){const t=function(){return $n(this,arguments,function*(){var s,r;const i=yield j(n);(s=e==null?void 0:e.onHeader)===null||s===void 0||s.call(e,i.header),yield j(yield*Nn(Lt(i.message))),(r=e==null?void 0:e.onTrailer)===null||r===void 0||r.call(e,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function M(n,e){return e in n&&n[e]!==void 0}function Pn(n){return M(n,"file")}function Dn(n){return M(n,"recentFile")}function Un(n){return M(n,"folder")}function Bn(n){return M(n,"sourceFolder")}function Ms(n){return M(n,"selection")}function qn(n){return M(n,"externalSource")}function Rs(n){return M(n,"allDefaultContext")}function As(n){return M(n,"clearContext")}function Cs(n){return M(n,"userGuidelines")}function On(n){return M(n,"personality")}function Ln(n){return M(n,"rule")}const Es={allDefaultContext:!0,label:"Default Context",id:"allDefaultContext"},Ns={clearContext:!0,label:"Clear Context",id:"clearContext"},$s={userGuidelines:{overLimit:!1,contents:"",lengthLimit:2e3},label:"User Guidelines",id:"userGuidelines"},Fs={agentMemories:{},label:"Agent Memories",id:"agentMemories"},dt=[{personality:{type:I.DEFAULT,description:"Expert software engineer - trusted coding agent, at your service!"},label:"Agent Auggie",name:"auggie-personality-agent-default",id:"auggie-personality-agent-default"},{personality:{type:I.PROTOTYPER,description:"Fast and loose - let's get it done, boss!"},label:"Prototyper Auggie",name:"auggie-personality-prototyper",id:"auggie-personality-prototyper"},{personality:{type:I.BRAINSTORM,description:"Thoughtful and creative - thinking through all possibilities..."},label:"Brainstorm Auggie",name:"auggie-personality-brainstorm",id:"auggie-personality-brainstorm"},{personality:{type:I.REVIEWER,description:"Code detective - finding issues and analyzing implications"},label:"Reviewer Auggie",name:"auggie-personality-reviewer",id:"auggie-personality-reviewer"}];function Ps(n){return M(n,"group")}function Ds(n){const e=new Map;return n.forEach(t=>{Pn(t)?e.set("file",[...e.get("file")??[],t]):Dn(t)?e.set("recentFile",[...e.get("recentFile")??[],t]):Un(t)?e.set("folder",[...e.get("folder")??[],t]):qn(t)?e.set("externalSource",[...e.get("externalSource")??[],t]):Bn(t)?e.set("sourceFolder",[...e.get("sourceFolder")??[],t]):On(t)?e.set("personality",[...e.get("personality")??[],t]):Ln(t)&&e.set("rule",[...e.get("rule")??[],t])}),[{label:"Personalities",id:"personalities",group:{type:"personality",materialIcon:"person",items:e.get("personality")??[]}},{label:"Files",id:"files",group:{type:"file",materialIcon:"insert_drive_file",items:e.get("file")??[]}},{label:"Folders",id:"folders",group:{type:"folder",materialIcon:"folder",items:e.get("folder")??[]}},{label:"Source Folders",id:"sourceFolders",group:{type:"sourceFolder",materialIcon:"folder_managed",items:e.get("sourceFolder")??[]}},{label:"Recently Opened Files",id:"recentlyOpenedFiles",group:{type:"recentFile",materialIcon:"insert_drive_file",items:e.get("recentFile")??[]}},{label:"Documentation",id:"externalSources",group:{type:"externalSource",materialIcon:"link",items:e.get("externalSource")??[]}},{label:"Rules",id:"rules",group:{type:"rule",materialIcon:"rule",items:e.get("rule")??[]}}].filter(t=>t.group.items.length>0)}function zn(n){const e=Qt({rootPath:n.repoRoot,relPath:n.pathName}),t={label:cn(n.pathName).split("/").filter(s=>s.trim()!=="").pop()||"",name:e,id:e};if(n.fullRange){const s=`:L${n.fullRange.startLineNumber}-${n.fullRange.endLineNumber}`;t.label+=s,t.name+=s,t.id+=s}else if(n.range){const s=`:L${n.range.start}-${n.range.stop}`;t.label+=s,t.name+=s,t.id+=s}return t}function jn(n){const e=n.path.split("/"),t=e[e.length-1],s=t.endsWith(".md")?t.slice(0,-3):t,r=`${Jt}/${en}/${n.path}`;return{label:s,name:r,id:r}}function Hn(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let q={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function gt(n){q=n}const zt=/[&<>"']/,Kn=new RegExp(zt.source,"g"),jt=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,Vn=new RegExp(jt.source,"g"),Gn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pt=n=>Gn[n];function T(n,e){if(e){if(zt.test(n))return n.replace(Kn,pt)}else if(jt.test(n))return n.replace(Vn,pt);return n}const Xn=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Zn(n){return n.replace(Xn,(e,t)=>(t=t.toLowerCase())==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):"")}const Yn=/(^|[^\[])\^/g;function k(n,e){let t=typeof n=="string"?n:n.source;e=e||"";const s={replace:(r,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(Yn,"$1"),t=t.replace(r,a),s},getRegex:()=>new RegExp(t,e)};return s}function ft(n){try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const X={exec:()=>null};function mt(n,e){const t=n.replace(/\|/g,(r,i,a)=>{let o=!1,c=i;for(;--c>=0&&a[c]==="\\";)o=!o;return o?"|":" |"}).split(/ \|/);let s=0;if(t[0].trim()||t.shift(),t.length>0&&!t[t.length-1].trim()&&t.pop(),e)if(t.length>e)t.splice(e);else for(;t.length<e;)t.push("");for(;s<t.length;s++)t[s]=t[s].trim().replace(/\\\|/g,"|");return t}function re(n,e,t){const s=n.length;if(s===0)return"";let r=0;for(;r<s;){const i=n.charAt(s-r-1);if(i!==e||t){if(i===e||!t)break;r++}else r++}return n.slice(0,s-r)}function yt(n,e,t,s){const r=e.href,i=e.title?T(e.title):null,a=n[1].replace(/\\([\[\]])/g,"$1");if(n[0].charAt(0)!=="!"){s.state.inLink=!0;const o={type:"link",raw:t,href:r,title:i,text:a,tokens:s.inlineTokens(a)};return s.state.inLink=!1,o}return{type:"image",raw:t,href:r,title:i,text:T(a)}}class ce{constructor(e){l(this,"options");l(this,"rules");l(this,"lexer");this.options=e||q}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const s=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:re(s,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const s=t[0],r=function(i,a){const o=i.match(/^(\s+)(?:```)/);if(o===null)return a;const c=o[1];return a.split(`
`).map(u=>{const h=u.match(/^\s+/);if(h===null)return u;const[g]=h;return g.length>=c.length?u.slice(c.length):u}).join(`
`)}(s,t[3]||"");return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let s=t[2].trim();if(/#$/.test(s)){const r=re(s,"#");this.options.pedantic?s=r.trim():r&&!/ $/.test(r)||(s=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const s=re(t[0].replace(/^ *>[ \t]?/gm,""),`
`),r=this.lexer.state.top;this.lexer.state.top=!0;const i=this.lexer.blockTokens(s);return this.lexer.state.top=r,{type:"blockquote",raw:t[0],tokens:i,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let s=t[1].trim();const r=s.length>1,i={type:"list",raw:"",ordered:r,start:r?+s.slice(0,-1):"",loose:!1,items:[]};s=r?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=r?s:"[*+-]");const a=new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`);let o="",c="",u=!1;for(;e;){let h=!1;if(!(t=a.exec(e))||this.rules.block.hr.test(e))break;o=t[0],e=e.substring(o.length);let g=t[2].split(`
`,1)[0].replace(/^\t+/,N=>" ".repeat(3*N.length)),p=e.split(`
`,1)[0],m=0;this.options.pedantic?(m=2,c=g.trimStart()):(m=t[2].search(/[^ ]/),m=m>4?1:m,c=g.slice(m),m+=t[1].length);let w=!1;if(!g&&/^ *$/.test(p)&&(o+=p+`
`,e=e.substring(p.length+1),h=!0),!h){const N=new RegExp(`^ {0,${Math.min(3,m-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),O=new RegExp(`^ {0,${Math.min(3,m-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),ee=new RegExp(`^ {0,${Math.min(3,m-1)}}(?:\`\`\`|~~~)`),Ge=new RegExp(`^ {0,${Math.min(3,m-1)}}#`);for(;e;){const ge=e.split(`
`,1)[0];if(p=ge,this.options.pedantic&&(p=p.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),ee.test(p)||Ge.test(p)||N.test(p)||O.test(e))break;if(p.search(/[^ ]/)>=m||!p.trim())c+=`
`+p.slice(m);else{if(w||g.search(/[^ ]/)>=4||ee.test(g)||Ge.test(g)||O.test(g))break;c+=`
`+p}w||p.trim()||(w=!0),o+=ge+`
`,e=e.substring(ge.length+1),g=p.slice(m)}}i.loose||(u?i.loose=!0:/\n *\n *$/.test(o)&&(u=!0));let _,y=null;this.options.gfm&&(y=/^\[[ xX]\] /.exec(c),y&&(_=y[0]!=="[ ] ",c=c.replace(/^\[[ xX]\] +/,""))),i.items.push({type:"list_item",raw:o,task:!!y,checked:_,loose:!1,text:c,tokens:[]}),i.raw+=o}i.items[i.items.length-1].raw=o.trimEnd(),i.items[i.items.length-1].text=c.trimEnd(),i.raw=i.raw.trimEnd();for(let h=0;h<i.items.length;h++)if(this.lexer.state.top=!1,i.items[h].tokens=this.lexer.blockTokens(i.items[h].text,[]),!i.loose){const g=i.items[h].tokens.filter(m=>m.type==="space"),p=g.length>0&&g.some(m=>/\n.*\n/.test(m.raw));i.loose=p}if(i.loose)for(let h=0;h<i.items.length;h++)i.items[h].loose=!0;return i}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const s=t[1].toLowerCase().replace(/\s+/g," "),r=t[2]?t[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:r,title:i}}}table(e){const t=this.rules.block.table.exec(e);if(!t||!/[:|]/.test(t[2]))return;const s=mt(t[1]),r=t[2].replace(/^\||\| *$/g,"").split("|"),i=t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===r.length){for(const o of r)/^ *-+: *$/.test(o)?a.align.push("right"):/^ *:-+: *$/.test(o)?a.align.push("center"):/^ *:-+ *$/.test(o)?a.align.push("left"):a.align.push(null);for(const o of s)a.header.push({text:o,tokens:this.lexer.inline(o)});for(const o of i)a.rows.push(mt(o,a.header.length).map(c=>({text:c,tokens:this.lexer.inline(c)})));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:T(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const s=t[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;const a=re(s.slice(0,-1),"\\");if((s.length-a.length)%2==0)return}else{const a=function(o,c){if(o.indexOf(c[1])===-1)return-1;let u=0;for(let h=0;h<o.length;h++)if(o[h]==="\\")h++;else if(o[h]===c[0])u++;else if(o[h]===c[1]&&(u--,u<0))return h;return-1}(t[2],"()");if(a>-1){const o=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let r=t[2],i="";if(this.options.pedantic){const a=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r);a&&(r=a[1],i=a[3])}else i=t[3]?t[3].slice(1,-1):"";return r=r.trim(),/^</.test(r)&&(r=this.options.pedantic&&!/>$/.test(s)?r.slice(1):r.slice(1,-1)),yt(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer)}}reflink(e,t){let s;if((s=this.rules.inline.reflink.exec(e))||(s=this.rules.inline.nolink.exec(e))){const r=t[(s[2]||s[1]).replace(/\s+/g," ").toLowerCase()];if(!r){const i=s[0].charAt(0);return{type:"text",raw:i,text:i}}return yt(s,r,s[0],this.lexer)}}emStrong(e,t,s=""){let r=this.rules.inline.emStrongLDelim.exec(e);if(r&&!(r[3]&&s.match(/[\p{L}\p{N}]/u))&&(!(r[1]||r[2])||!s||this.rules.inline.punctuation.exec(s))){const i=[...r[0]].length-1;let a,o,c=i,u=0;const h=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,t=t.slice(-1*e.length+i);(r=h.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=[...a].length,r[3]||r[4]){c+=o;continue}if((r[5]||r[6])&&i%3&&!((i+o)%3)){u+=o;continue}if(c-=o,c>0)continue;o=Math.min(o,o+c+u);const g=[...r[0]][0].length,p=e.slice(0,i+r.index+g+o);if(Math.min(i,o)%2){const w=p.slice(1,-1);return{type:"em",raw:p,text:w,tokens:this.lexer.inlineTokens(w)}}const m=p.slice(2,-2);return{type:"strong",raw:p,text:m,tokens:this.lexer.inlineTokens(m)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let s=t[2].replace(/\n/g," ");const r=/[^ ]/.test(s),i=/^ /.test(s)&&/ $/.test(s);return r&&i&&(s=s.substring(1,s.length-1)),s=T(s,!0),{type:"codespan",raw:t[0],text:s}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let s,r;return t[2]==="@"?(s=T(t[1]),r="mailto:"+s):(s=T(t[1]),r=s),{type:"link",raw:t[0],text:s,href:r,tokens:[{type:"text",raw:s,text:s}]}}}url(e){var s;let t;if(t=this.rules.inline.url.exec(e)){let r,i;if(t[2]==="@")r=T(t[0]),i="mailto:"+r;else{let a;do a=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(a!==t[0]);r=T(t[0]),i=t[1]==="www."?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:r,href:i,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){let s;return s=this.lexer.state.inRawBlock?t[0]:T(t[0]),{type:"text",raw:t[0],text:s}}}}const Q=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ht=/(?:[*+-]|\d{1,9}[.)])/,Kt=k(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Ht).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Le=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ze=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Wn=k(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",ze).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Qn=k(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ht).getRegex(),de="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",je=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Jn=k("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",je).replace("tag",de).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),bt=k(Le).replace("hr",Q).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",de).getRegex(),He={blockquote:k(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",bt).getRegex(),code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,def:Wn,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:Q,html:Jn,lheading:Kt,list:Qn,newline:/^(?: *(?:\n|$))+/,paragraph:bt,table:X,text:/^[^\n]+/},kt=k("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Q).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",de).getRegex(),es={...He,table:kt,paragraph:k(Le).replace("hr",Q).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",kt).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",de).getRegex()},ts={...He,html:k(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",je).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:X,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:k(Le).replace("hr",Q).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Kt).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Vt=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Gt=/^( {2,}|\\)\n(?!\s*$)/,J="\\p{P}\\p{S}",ns=k(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,J).getRegex(),ss=k(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,J).getRegex(),rs=k("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,J).getRegex(),is=k("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,J).getRegex(),as=k(/\\([punct])/,"gu").replace(/punct/g,J).getRegex(),os=k(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),ls=k(je).replace("(?:-->|$)","-->").getRegex(),cs=k("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",ls).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),ue=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,us=k(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",ue).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),wt=k(/^!?\[(label)\]\[(ref)\]/).replace("label",ue).replace("ref",ze).getRegex(),_t=k(/^!?\[(ref)\](?:\[\])?/).replace("ref",ze).getRegex(),Ke={_backpedal:X,anyPunctuation:as,autolink:os,blockSkip:/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,br:Gt,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:X,emStrongLDelim:ss,emStrongRDelimAst:rs,emStrongRDelimUnd:is,escape:Vt,link:us,nolink:_t,punctuation:ns,reflink:wt,reflinkSearch:k("reflink|nolink(?!\\()","g").replace("reflink",wt).replace("nolink",_t).getRegex(),tag:cs,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:X},hs={...Ke,link:k(/^!?\[(label)\]\((.*?)\)/).replace("label",ue).getRegex(),reflink:k(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",ue).getRegex()},Me={...Ke,escape:k(Vt).replace("])","~|])").getRegex(),url:k(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ds={...Me,br:k(Gt).replace("{2,}","*").getRegex(),text:k(Me.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ie={normal:He,gfm:es,pedantic:ts},V={normal:Ke,gfm:Me,breaks:ds,pedantic:hs};class C{constructor(e){l(this,"tokens");l(this,"options");l(this,"state");l(this,"tokenizer");l(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||q,this.options.tokenizer=this.options.tokenizer||new ce,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:ie.normal,inline:V.normal};this.options.pedantic?(t.block=ie.pedantic,t.inline=V.pedantic):this.options.gfm&&(t.block=ie.gfm,this.options.breaks?t.inline=V.breaks:t.inline=V.gfm),this.tokenizer.rules=t}static get rules(){return{block:ie,inline:V}}static lex(e,t){return new C(t).lex(e)}static lexInline(e,t){return new C(t).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const s=this.inlineQueue[t];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[]){let s,r,i,a;for(e=this.options.pedantic?e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e.replace(/^( *)(\t+)/gm,(o,c,u)=>c+"    ".repeat(u.length));e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(o=>!!(s=o.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))if(s=this.tokenizer.space(e))e=e.substring(s.raw.length),s.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(s);else if(s=this.tokenizer.code(e))e=e.substring(s.raw.length),r=t[t.length-1],!r||r.type!=="paragraph"&&r.type!=="text"?t.push(s):(r.raw+=`
`+s.raw,r.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(s=this.tokenizer.fences(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.heading(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.hr(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.blockquote(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.list(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.html(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.def(e))e=e.substring(s.raw.length),r=t[t.length-1],!r||r.type!=="paragraph"&&r.type!=="text"?this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title}):(r.raw+=`
`+s.raw,r.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text);else if(s=this.tokenizer.table(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.lheading(e))e=e.substring(s.raw.length),t.push(s);else{if(i=e,this.options.extensions&&this.options.extensions.startBlock){let o=1/0;const c=e.slice(1);let u;this.options.extensions.startBlock.forEach(h=>{u=h.call({lexer:this},c),typeof u=="number"&&u>=0&&(o=Math.min(o,u))}),o<1/0&&o>=0&&(i=e.substring(0,o+1))}if(this.state.top&&(s=this.tokenizer.paragraph(i)))r=t[t.length-1],a&&r.type==="paragraph"?(r.raw+=`
`+s.raw,r.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(s),a=i.length!==e.length,e=e.substring(s.raw.length);else if(s=this.tokenizer.text(e))e=e.substring(s.raw.length),r=t[t.length-1],r&&r.type==="text"?(r.raw+=`
`+s.raw,r.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(s);else if(e){const o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let s,r,i,a,o,c,u=e;if(this.tokens.links){const h=Object.keys(this.tokens.links);if(h.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)h.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(u))!=null;)u=u.slice(0,a.index)+"++"+u.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;e;)if(o||(c=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(h=>!!(s=h.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))if(s=this.tokenizer.escape(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.tag(e))e=e.substring(s.raw.length),r=t[t.length-1],r&&s.type==="text"&&r.type==="text"?(r.raw+=s.raw,r.text+=s.text):t.push(s);else if(s=this.tokenizer.link(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.reflink(e,this.tokens.links))e=e.substring(s.raw.length),r=t[t.length-1],r&&s.type==="text"&&r.type==="text"?(r.raw+=s.raw,r.text+=s.text):t.push(s);else if(s=this.tokenizer.emStrong(e,u,c))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.codespan(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.br(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.del(e))e=e.substring(s.raw.length),t.push(s);else if(s=this.tokenizer.autolink(e))e=e.substring(s.raw.length),t.push(s);else if(this.state.inLink||!(s=this.tokenizer.url(e))){if(i=e,this.options.extensions&&this.options.extensions.startInline){let h=1/0;const g=e.slice(1);let p;this.options.extensions.startInline.forEach(m=>{p=m.call({lexer:this},g),typeof p=="number"&&p>=0&&(h=Math.min(h,p))}),h<1/0&&h>=0&&(i=e.substring(0,h+1))}if(s=this.tokenizer.inlineText(i))e=e.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(c=s.raw.slice(-1)),o=!0,r=t[t.length-1],r&&r.type==="text"?(r.raw+=s.raw,r.text+=s.text):t.push(s);else if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}throw new Error(h)}}else e=e.substring(s.raw.length),t.push(s);return t}}class he{constructor(e){l(this,"options");this.options=e||q}code(e,t,s){var i;const r=(i=(t||"").match(/^\S*/))==null?void 0:i[0];return e=e.replace(/\n$/,"")+`
`,r?'<pre><code class="language-'+T(r)+'">'+(s?e:T(e,!0))+`</code></pre>
`:"<pre><code>"+(s?e:T(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e,t){return e}heading(e,t,s){return`<h${t}>${e}</h${t}>
`}hr(){return`<hr>
`}list(e,t,s){const r=t?"ol":"ul";return"<"+r+(t&&s!==1?' start="'+s+'"':"")+`>
`+e+"</"+r+`>
`}listitem(e,t,s){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(e){return`<p>${e}</p>
`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+t+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,t){const s=t.header?"th":"td";return(t.align?`<${s} align="${t.align}">`:`<${s}>`)+e+`</${s}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return"<br>"}del(e){return`<del>${e}</del>`}link(e,t,s){const r=ft(e);if(r===null)return s;let i='<a href="'+(e=r)+'"';return t&&(i+=' title="'+t+'"'),i+=">"+s+"</a>",i}image(e,t,s){const r=ft(e);if(r===null)return s;let i=`<img src="${e=r}" alt="${s}"`;return t&&(i+=` title="${t}"`),i+=">",i}text(e){return e}}class Ve{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,s){return""+s}image(e,t,s){return""+s}br(){return""}}class E{constructor(e){l(this,"options");l(this,"renderer");l(this,"textRenderer");this.options=e||q,this.options.renderer=this.options.renderer||new he,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Ve}static parse(e,t){return new E(t).parse(e)}static parseInline(e,t){return new E(t).parseInline(e)}parse(e,t=!0){let s="";for(let r=0;r<e.length;r++){const i=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){const a=i,o=this.options.extensions.renderers[a.type].call({parser:this},a);if(o!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){s+=o||"";continue}}switch(i.type){case"space":continue;case"hr":s+=this.renderer.hr();continue;case"heading":{const a=i;s+=this.renderer.heading(this.parseInline(a.tokens),a.depth,Zn(this.parseInline(a.tokens,this.textRenderer)));continue}case"code":{const a=i;s+=this.renderer.code(a.text,a.lang,!!a.escaped);continue}case"table":{const a=i;let o="",c="";for(let h=0;h<a.header.length;h++)c+=this.renderer.tablecell(this.parseInline(a.header[h].tokens),{header:!0,align:a.align[h]});o+=this.renderer.tablerow(c);let u="";for(let h=0;h<a.rows.length;h++){const g=a.rows[h];c="";for(let p=0;p<g.length;p++)c+=this.renderer.tablecell(this.parseInline(g[p].tokens),{header:!1,align:a.align[p]});u+=this.renderer.tablerow(c)}s+=this.renderer.table(o,u);continue}case"blockquote":{const a=i,o=this.parse(a.tokens);s+=this.renderer.blockquote(o);continue}case"list":{const a=i,o=a.ordered,c=a.start,u=a.loose;let h="";for(let g=0;g<a.items.length;g++){const p=a.items[g],m=p.checked,w=p.task;let _="";if(p.task){const y=this.renderer.checkbox(!!m);u?p.tokens.length>0&&p.tokens[0].type==="paragraph"?(p.tokens[0].text=y+" "+p.tokens[0].text,p.tokens[0].tokens&&p.tokens[0].tokens.length>0&&p.tokens[0].tokens[0].type==="text"&&(p.tokens[0].tokens[0].text=y+" "+p.tokens[0].tokens[0].text)):p.tokens.unshift({type:"text",text:y+" "}):_+=y+" "}_+=this.parse(p.tokens,u),h+=this.renderer.listitem(_,w,!!m)}s+=this.renderer.list(h,o,c);continue}case"html":{const a=i;s+=this.renderer.html(a.text,a.block);continue}case"paragraph":{const a=i;s+=this.renderer.paragraph(this.parseInline(a.tokens));continue}case"text":{let a=i,o=a.tokens?this.parseInline(a.tokens):a.text;for(;r+1<e.length&&e[r+1].type==="text";)a=e[++r],o+=`
`+(a.tokens?this.parseInline(a.tokens):a.text);s+=t?this.renderer.paragraph(o):o;continue}default:{const a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}parseInline(e,t){t=t||this.renderer;let s="";for(let r=0;r<e.length;r++){const i=e[r];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[i.type]){const a=this.options.extensions.renderers[i.type].call({parser:this},i);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){s+=a||"";continue}}switch(i.type){case"escape":{const a=i;s+=t.text(a.text);break}case"html":{const a=i;s+=t.html(a.text);break}case"link":{const a=i;s+=t.link(a.href,a.title,this.parseInline(a.tokens,t));break}case"image":{const a=i;s+=t.image(a.href,a.title,a.text);break}case"strong":{const a=i;s+=t.strong(this.parseInline(a.tokens,t));break}case"em":{const a=i;s+=t.em(this.parseInline(a.tokens,t));break}case"codespan":{const a=i;s+=t.codespan(a.text);break}case"br":s+=t.br();break;case"del":{const a=i;s+=t.del(this.parseInline(a.tokens,t));break}case"text":{const a=i;s+=t.text(a.text);break}default:{const a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return s}}class Z{constructor(e){l(this,"options");this.options=e||q}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}}l(Z,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var B,Re,Xt,St;const U=new(St=class{constructor(...n){Ze(this,B);l(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null});l(this,"options",this.setOptions);l(this,"parse",te(this,B,Re).call(this,C.lex,E.parse));l(this,"parseInline",te(this,B,Re).call(this,C.lexInline,E.parseInline));l(this,"Parser",E);l(this,"Renderer",he);l(this,"TextRenderer",Ve);l(this,"Lexer",C);l(this,"Tokenizer",ce);l(this,"Hooks",Z);this.use(...n)}walkTokens(n,e){var s,r;let t=[];for(const i of n)switch(t=t.concat(e.call(this,i)),i.type){case"table":{const a=i;for(const o of a.header)t=t.concat(this.walkTokens(o.tokens,e));for(const o of a.rows)for(const c of o)t=t.concat(this.walkTokens(c.tokens,e));break}case"list":{const a=i;t=t.concat(this.walkTokens(a.items,e));break}default:{const a=i;(r=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&r[a.type]?this.defaults.extensions.childTokens[a.type].forEach(o=>{const c=a[o].flat(1/0);t=t.concat(this.walkTokens(c,e))}):a.tokens&&(t=t.concat(this.walkTokens(a.tokens,e)))}}return t}use(...n){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{const s={...t};if(s.async=this.defaults.async||s.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const i=e.renderers[r.name];e.renderers[r.name]=i?function(...a){let o=r.renderer.apply(this,a);return o===!1&&(o=i.apply(this,a)),o}:r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const i=e[r.level];i?i.unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),s.extensions=e),t.renderer){const r=this.defaults.renderer||new he(this.defaults);for(const i in t.renderer){if(!(i in r))throw new Error(`renderer '${i}' does not exist`);if(i==="options")continue;const a=i,o=t.renderer[a],c=r[a];r[a]=(...u)=>{let h=o.apply(r,u);return h===!1&&(h=c.apply(r,u)),h||""}}s.renderer=r}if(t.tokenizer){const r=this.defaults.tokenizer||new ce(this.defaults);for(const i in t.tokenizer){if(!(i in r))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;const a=i,o=t.tokenizer[a],c=r[a];r[a]=(...u)=>{let h=o.apply(r,u);return h===!1&&(h=c.apply(r,u)),h}}s.tokenizer=r}if(t.hooks){const r=this.defaults.hooks||new Z;for(const i in t.hooks){if(!(i in r))throw new Error(`hook '${i}' does not exist`);if(i==="options")continue;const a=i,o=t.hooks[a],c=r[a];Z.passThroughHooks.has(i)?r[a]=u=>{if(this.defaults.async)return Promise.resolve(o.call(r,u)).then(g=>c.call(r,g));const h=o.call(r,u);return c.call(r,h)}:r[a]=(...u)=>{let h=o.apply(r,u);return h===!1&&(h=c.apply(r,u)),h}}s.hooks=r}if(t.walkTokens){const r=this.defaults.walkTokens,i=t.walkTokens;s.walkTokens=function(a){let o=[];return o.push(i.call(this,a)),r&&(o=o.concat(r.call(this,a))),o}}this.defaults={...this.defaults,...s}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return C.lex(n,e??this.defaults)}parser(n,e){return E.parse(n,e??this.defaults)}},B=new WeakSet,Re=function(n,e){return(t,s)=>{const r={...s},i={...this.defaults,...r};this.defaults.async===!0&&r.async===!1&&(i.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),i.async=!0);const a=te(this,B,Xt).call(this,!!i.silent,!!i.async);if(t==null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(i.hooks&&(i.hooks.options=i),i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(o=>n(o,i)).then(o=>i.hooks?i.hooks.processAllTokens(o):o).then(o=>i.walkTokens?Promise.all(this.walkTokens(o,i.walkTokens)).then(()=>o):o).then(o=>e(o,i)).then(o=>i.hooks?i.hooks.postprocess(o):o).catch(a);try{i.hooks&&(t=i.hooks.preprocess(t));let o=n(t,i);i.hooks&&(o=i.hooks.processAllTokens(o)),i.walkTokens&&this.walkTokens(o,i.walkTokens);let c=e(o,i);return i.hooks&&(c=i.hooks.postprocess(c)),c}catch(o){return a(o)}}},Xt=function(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){const s="<p>An error occurred:</p><pre>"+T(t.message+"",!0)+"</pre>";return e?Promise.resolve(s):s}if(e)return Promise.reject(t);throw t}},St);function b(n,e){return U.parse(n,e)}function Us(n,e){const t=n.customPersonalityPrompts;if(t)switch(e){case I.DEFAULT:if(t.agent&&t.agent.trim()!=="")return t.agent;break;case I.PROTOTYPER:if(t.prototyper&&t.prototyper.trim()!=="")return t.prototyper;break;case I.BRAINSTORM:if(t.brainstorm&&t.brainstorm.trim()!=="")return t.brainstorm;break;case I.REVIEWER:if(t.reviewer&&t.reviewer.trim()!=="")return t.reviewer}return gs[e]}b.options=b.setOptions=function(n){return U.setOptions(n),b.defaults=U.defaults,gt(b.defaults),b},b.getDefaults=Hn,b.defaults=q,b.use=function(...n){return U.use(...n),b.defaults=U.defaults,gt(b.defaults),b},b.walkTokens=function(n,e){return U.walkTokens(n,e)},b.parseInline=U.parseInline,b.Parser=E,b.parser=E.parse,b.Renderer=he,b.TextRenderer=Ve,b.Lexer=C,b.lexer=C.lex,b.Tokenizer=ce,b.Hooks=Z,b.parse=b,b.options,b.setOptions,b.use,b.walkTokens,b.parseInline,E.parse,C.lex;const gs={[I.DEFAULT]:`
# Agent Auggie Personality Description
You are Augment Agent, an agentic coding AI assistant.
Focus on helping the user with their coding tasks efficiently.

## Rules:
- You have no restrictions on the tools you may use
- Follow the original system instructions
  `,[I.PROTOTYPER]:`
# Prototyper Auggie Personality Description
You are Prototyper Auggie, an agentic coding AI assistant focused on building prototypes and visual applications.

## Your approach:
- Be fast and action-oriented
- Implement things quickly to show results
- Open webpages to demonstrate functionality
- Focus on building something visual and interactive
- Use modern frameworks and tools to create working prototypes
- Prioritize getting a working demo over perfect architecture
- Show progress frequently with visual results
- Prefer to act and run tools, rather than asking for permission
- Only ask for permission if there is something potentially very dangerous or irreversible

## Implementation preferences:
- When user does not specify which frameworks to use, default to modern frameworks, e.g. React with vite or next.js
- Initialize projects using CLI tools instead of writing from scratch
- For database and auth, use Supabase as a good default option
- Before using open-browser to show the app, use curl to check for errors
- Remember that modern frameworks have hot reload, so avoid calling open-browser multiple times

## Rules:
- For extremely destructive or irreversible actions, you should ask for permission
- For other tasks, you must proceed without asking for permission
  `,[I.BRAINSTORM]:`
# Brainstorm Auggie Personality Description
You are Brainstorm Auggie, an agentic coding AI assistant focused on planning and brainstorming solutions.

## Your approach:
- Be slow, careful, and thorough in your analysis
- Look through all upstream/downstream APIs to understand implications
- Focus on finding a comprehensive plan that solves the user's query
- Do not run commands, create code, or implement solutions directly
- Your job is to be introspective and think deeply about the problem
- Brainstorm multiple approaches and evaluate their tradeoffs
- Consider edge cases and potential issues with each approach

## Planning preferences:
- Analyze the codebase thoroughly before suggesting changes
- Consider multiple implementation options with pros and cons
- Identify potential risks and challenges for each approach
- Create detailed, step-by-step plans for implementation
- Provide reasoning for architectural decisions
- Consider performance, maintainability, and scalability
- Do not execute the plan - your role is to provide guidance only

## Rules:
- Prefer information gathering and non-destructive tools
- Prefer non-destructive and non-modifying tools
- You must never execute code, modify the codebase, or make changes
- Consider using Mermaid diagrams to help visualize complex concepts
- Once you have a proposal, please examine it critically, and do a revision before finalizing
  `,[I.REVIEWER]:`
# Reviewer Auggie Personality Description
You are Reviewer Auggie, an agentic coding AI assistant focused on reviewing code changes and identifying potential issues.

## Your approach:
- Act like a code detective to find potential bugs and issues
- Use git commands to analyze changes against the merge base
- Be super inquisitive and look for anything suspicious
- Build a mental model of what is happening in the code change
- Analyze API implications and downstream effects
- Guard the codebase from potential negative side effects
- Focus on understanding the changes from first principles

## Review preferences:
- Use git and GitHub tools to get code history information
- Compare changes against the logical base or merge base
- Look for edge cases and potential bugs
- Analyze API contracts and potential breaking changes
- Consider performance implications
- Check for security vulnerabilities
- Verify test coverage for the changes

## Rules:
- Use git commands and GitHub API to analyze code changes
- Be thorough and methodical in your analysis
- Focus on finding potential issues rather than implementing solutions
- Provide constructive feedback with specific examples
- Consider both the technical implementation and the broader impact
  `},Bs="augment-welcome";var x=(n=>(n.draft="draft",n.sent="sent",n.failed="failed",n.success="success",n.cancelled="cancelled",n))(x||{}),A=(n=>(n.seen="seen",n.unseen="unseen",n))(A||{}),ps=(n=>(n.signInWelcome="sign-in-welcome",n.generateCommitMessage="generate-commit-message",n.summaryResponse="summary-response",n.summaryTitle="summary-title",n.educateFeatures="educate-features",n.agentOnboarding="agent-onboarding",n.agenticTurnDelimiter="agentic-turn-delimiter",n.agenticRevertDelimiter="agentic-revert-delimiter",n.agenticCheckpointDelimiter="agentic-checkpoint-delimiter",n.exchange="exchange",n.exchangePointer="exchange-pointer",n.historySummary="history-summary",n))(ps||{});function fs(n){return!!n&&(n.chatItemType===void 0||n.chatItemType==="agent-onboarding")}function qs(n){return fs(n)&&n.status==="success"}function Os(n){return!!n&&n.chatItemType==="exchange-pointer"}function Ls(n){return n.chatItemType==="agentic-checkpoint-delimiter"}function zs(n){return n.chatItemType==="history-summary"}async function*ms(n,e=1e3){for(;n>0;)yield n,await new Promise(t=>setTimeout(t,Math.min(e,n))),n-=e}class ys{constructor(e,t,s,r=5,i=4e3,a){l(this,"_isCancelled",!1);this.requestId=e,this.chatMessage=t,this.startStreamFn=s,this.maxRetries=r,this.baseDelay=i,this.flags=a}cancel(){this._isCancelled=!0}async*getStream(){let e=0,t=0,s=!1;try{for(;!this._isCancelled;){const r=this.startStreamFn({...this.chatMessage,createdTimestamp:Date.now()},this.flags?{flags:this.flags}:void 0);let i,a,o=!1,c=!0;for await(const u of r){if(u.status===x.failed){if(u.isRetriable!==!0||s)return yield u;o=!0,c=u.shouldBackoff??!0,i=u.display_error_message,a=u.request_id;break}s=!0,yield u}if(!o)return;if(this._isCancelled)return yield this.createCancelledStatus();if(e++,e>this.maxRetries)return void(yield{request_id:a??this.requestId,seen_state:A.unseen,status:x.failed,display_error_message:i,isRetriable:!1});if(c){const u=this.baseDelay*2**t;t++;for await(const h of ms(u))yield{request_id:this.requestId,status:x.sent,display_error_message:`Service temporarily unavailable. Retrying in ${Math.floor(h/1e3)} seconds... (Attempt ${e} of ${this.maxRetries})`,isRetriable:!0}}yield{request_id:this.requestId,status:x.sent,display_error_message:`Generating response... (Attempt ${e+1})`,isRetriable:!0}}this._isCancelled&&(yield this.createCancelledStatus())}catch(r){yield{request_id:this.requestId,seen_state:A.unseen,status:x.failed,display_error_message:r instanceof Error?r.message:String(r)}}}createCancelledStatus(){return{request_id:this.requestId,seen_state:A.unseen,status:x.cancelled}}}class bs{constructor(e){l(this,"getHydratedTask",async e=>{const t={type:H.getHydratedTaskRequest,data:{uuid:e}};return(await this._asyncMsgSender.sendToSidecar(t,3e4)).data.task});l(this,"createTask",async(e,t,s)=>{const r={type:H.createTaskRequest,data:{name:e,description:t,parentTaskUuid:s}};return(await this._asyncMsgSender.sendToSidecar(r,3e4)).data.uuid});l(this,"updateTask",async(e,t,s)=>{const r={type:H.updateTaskRequest,data:{uuid:e,updates:t,updatedBy:s}};await this._asyncMsgSender.sendToSidecar(r,3e4)});l(this,"setCurrentRootTaskUuid",e=>{const t={type:H.setCurrentRootTaskUuid,data:{uuid:e}};this._asyncMsgSender.sendToSidecar(t)});l(this,"updateHydratedTask",async(e,t)=>{const s={type:H.updateHydratedTaskRequest,data:{task:e,updatedBy:t}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data});this._asyncMsgSender=e}}class js{constructor(e,t,s){l(this,"_taskClient");l(this,"getChatInitData",async()=>{const e=await this._asyncMsgSender.send({type:f.chatLoaded},3e4);if(e.data.enableDebugFeatures)try{console.log("Running hello world test...");const t=await async function(s){return(await Fn(rn,new sn({sendMessage:i=>{s.postMessage(i)},onReceiveMessage:i=>{const a=o=>{i(o.data)};return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}}})).testMethod({foo:"bar"},{timeoutMs:1e3})).result}(this._host);console.log("Hello world result:",t)}catch(t){console.error("Hello world error:",t)}return e.data});l(this,"reportWebviewClientEvent",e=>{this._asyncMsgSender.send({type:f.reportWebviewClientMetric,data:{webviewName:tn.chat,client_metric:e,value:1}})});l(this,"reportAgentSessionEvent",e=>{this._asyncMsgSender.sendToSidecar({type:S.reportAgentSessionEvent,data:e})});l(this,"reportAgentRequestEvent",e=>{this._asyncMsgSender.sendToSidecar({type:S.reportAgentRequestEvent,data:e})});l(this,"getSuggestions",async(e,t=!1)=>{const s={rootPath:"",relPath:e},r=this.findFiles(s,6),i=this.findRecentlyOpenedFiles(s,6),a=this.findFolders(s,3),o=this.findExternalSources(e,t),c=this._flags.enableRules?this.findRules(e,6):Promise.resolve([]),[u,h,g,p,m]=await Promise.all([G(r,[]),G(i,[]),G(a,[]),G(o,[]),G(c,[])]),w=(y,N)=>({...zn(y),[N]:y}),_=[...u.map(y=>w(y,"file")),...g.map(y=>w(y,"folder")),...h.map(y=>w(y,"recentFile")),...p.map(y=>({label:y.name,name:y.name,id:y.id,externalSource:y})),...m.map(y=>({...jn(y),rule:y}))];if(this._flags.enablePersonalities){const y=this.getPersonalities(e);y.length>0&&_.push(...y)}return _});l(this,"getPersonalities",e=>{if(!this._flags.enablePersonalities)return[];if(e==="")return dt;const t=e.toLowerCase();return dt.filter(s=>{const r=s.personality.description.toLowerCase(),i=s.label.toLowerCase();return r.includes(t)||i.includes(t)})});l(this,"sendAction",e=>{this._host.postMessage({type:f.mainPanelPerformAction,data:e})});l(this,"showAugmentPanel",()=>{this._asyncMsgSender.send({type:f.showAugmentPanel})});l(this,"showNotification",e=>{this._host.postMessage({type:f.showNotification,data:e})});l(this,"openConfirmationModal",async e=>(await this._asyncMsgSender.send({type:f.openConfirmationModal,data:e},1e9)).data.ok);l(this,"clearMetadataFor",e=>{this._host.postMessage({type:f.chatClearMetadata,data:e})});l(this,"resolvePath",async(e,t=void 0)=>{const s=await this._asyncMsgSender.send({type:f.resolveFileRequest,data:{...e,exactMatch:!0,maxResults:1,searchScope:t}},5e3);if(s.data)return s.data});l(this,"resolveSymbols",async(e,t)=>(await this._asyncMsgSender.send({type:f.findSymbolRequest,data:{query:e,searchScope:t}},3e4)).data);l(this,"getDiagnostics",async()=>(await this._asyncMsgSender.send({type:f.getDiagnosticsRequest},1e3)).data);l(this,"findFiles",async(e,t=12)=>(await this._asyncMsgSender.send({type:f.findFileRequest,data:{...e,maxResults:t}},5e3)).data);l(this,"findFolders",async(e,t=12)=>(await this._asyncMsgSender.send({type:f.findFolderRequest,data:{...e,maxResults:t}},5e3)).data);l(this,"findRecentlyOpenedFiles",async(e,t=12)=>(await this._asyncMsgSender.send({type:f.findRecentlyOpenedFilesRequest,data:{...e,maxResults:t}},5e3)).data);l(this,"findExternalSources",async(e,t=!1)=>this._flags.enableExternalSourcesInChat?t?[]:(await this._asyncMsgSender.send({type:f.findExternalSourcesRequest,data:{query:e,source_types:[]}},5e3)).data.sources??[]:[]);l(this,"findRules",async(e,t=12)=>(await this._asyncMsgSender.sendToSidecar({type:nn.getRulesListRequest,data:{query:e,maxResults:t}})).data.rules);l(this,"openFile",e=>{this._host.postMessage({type:f.openFile,data:e})});l(this,"saveFile",e=>this._host.postMessage({type:f.saveFile,data:e}));l(this,"loadFile",e=>this._host.postMessage({type:f.loadFile,data:e}));l(this,"openMemoriesFile",()=>{this._host.postMessage({type:f.openMemoriesFile})});l(this,"canShowTerminal",async(e,t)=>{try{return(await this._asyncMsgSender.send({type:f.canShowTerminal,data:{terminalId:e,command:t}},5e3)).data.canShow}catch(s){return console.error("Failed to check if terminal can be shown:",s),!1}});l(this,"showTerminal",async(e,t)=>{try{return(await this._asyncMsgSender.send({type:f.showTerminal,data:{terminalId:e,command:t}},5e3)).data.success}catch(s){return console.error("Failed to show terminal:",s),!1}});l(this,"createFile",(e,t)=>{this._host.postMessage({type:f.chatCreateFile,data:{code:e,relPath:t}})});l(this,"openScratchFile",async(e,t="shellscript")=>{await this._asyncMsgSender.send({type:f.openScratchFileRequest,data:{content:e,language:t}},1e4)});l(this,"resolveWorkspaceFileChunk",async e=>{try{return(await this._asyncMsgSender.send({type:f.resolveWorkspaceFileChunkRequest,data:e},5e3)).data}catch{return}});l(this,"smartPaste",e=>{this._host.postMessage({type:f.chatSmartPaste,data:e})});l(this,"getHydratedTask",async e=>this._taskClient.getHydratedTask(e));l(this,"updateHydratedTask",async(e,t)=>this._taskClient.updateHydratedTask(e,t));l(this,"setCurrentRootTaskUuid",e=>{this._taskClient.setCurrentRootTaskUuid(e)});l(this,"createTask",async(e,t,s)=>this._taskClient.createTask(e,t,s));l(this,"updateTask",async(e,t,s)=>this._taskClient.updateTask(e,t,s));l(this,"saveChat",async(e,t,s)=>this._asyncMsgSender.send({type:f.saveChat,data:{conversationId:e,chatHistory:t,title:s}},5e3));l(this,"updateUserGuidelines",e=>{this._host.postMessage({type:f.updateUserGuidelines,data:e})});l(this,"updateWorkspaceGuidelines",e=>{this._host.postMessage({type:f.updateWorkspaceGuidelines,data:e})});l(this,"openSettingsPage",e=>{this._host.postMessage({type:f.openSettingsPage,data:e})});l(this,"_activeRetryStreams",new Map);l(this,"cancelChatStream",async e=>{var t;(t=this._activeRetryStreams.get(e))==null||t.cancel(),await this._asyncMsgSender.send({type:f.chatUserCancel,data:{requestId:e}},1e4)});l(this,"sendUserRating",async(e,t,s,r="")=>{const i={requestId:e,rating:s,note:r,mode:t},a={type:f.chatRating,data:i};return(await this._asyncMsgSender.send(a,3e4)).data});l(this,"triggerUsedChatMetric",()=>{this._host.postMessage({type:f.usedChat})});l(this,"createProject",e=>{this._host.postMessage({type:f.mainPanelCreateProject,data:{name:e}})});l(this,"openProjectFolder",()=>{this._host.postMessage({type:f.mainPanelPerformAction,data:"open-folder"})});l(this,"closeProjectFolder",()=>{this._host.postMessage({type:f.mainPanelPerformAction,data:"close-folder"})});l(this,"cloneRepository",()=>{this._host.postMessage({type:f.mainPanelPerformAction,data:"clone-repository"})});l(this,"grantSyncPermission",()=>{this._host.postMessage({type:f.mainPanelPerformAction,data:"grant-sync-permission"})});l(this,"callTool",async(e,t,s,r,i,a)=>{const o={type:f.callTool,data:{chatRequestId:e,toolUseId:t,name:s,input:r,chatHistory:i,conversationId:a}};return(await this._asyncMsgSender.send(o,0)).data});l(this,"cancelToolRun",async(e,t)=>{const s={type:f.cancelToolRun,data:{requestId:e,toolUseId:t}};await this._asyncMsgSender.send(s,0)});l(this,"checkSafe",async e=>{const t={type:pe.checkToolCallSafeRequest,data:e};return(await this._asyncMsgSender.sendToSidecar(t,0)).data});l(this,"closeAllToolProcesses",async()=>{await this._asyncMsgSender.sendToSidecar({type:pe.closeAllToolProcesses},0)});l(this,"getToolIdentifier",async e=>{const t={type:pe.getToolIdentifierRequest,data:{toolName:e}};return(await this._asyncMsgSender.sendToSidecar(t,0)).data});l(this,"setChatMode",e=>{this._asyncMsgSender.send({type:f.chatModeChanged,data:{mode:e}})});l(this,"setLastUsedChatMode",e=>{this._asyncMsgSender.send({type:f.chatSetLastUsedChatMode,data:{mode:e}}).catch(t=>{console.error("Failed to set last used chat mode:",t)})});l(this,"getAgentEditList",async(e,t)=>{const s={type:S.getEditListRequest,data:{fromTimestamp:e,toTimestamp:t}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data});l(this,"hasChangesSince",async e=>{const t={type:S.getEditListRequest,data:{fromTimestamp:e,toTimestamp:Number.MAX_SAFE_INTEGER}};return(await this._asyncMsgSender.sendToSidecar(t,3e4)).data.edits.filter(s=>{var r,i;return((r=s.changesSummary)==null?void 0:r.totalAddedLines)||((i=s.changesSummary)==null?void 0:i.totalRemovedLines)}).length>0});l(this,"getToolCallCheckpoint",async e=>{const t={type:f.getToolCallCheckpoint,data:{requestId:e}};return(await this._asyncMsgSender.send(t,3e4)).data.checkpointNumber});l(this,"setCurrentConversation",e=>{this._asyncMsgSender.sendToSidecar({type:S.setCurrentConversation,data:{conversationId:e}})});l(this,"migrateConversationId",async(e,t)=>{await this._asyncMsgSender.sendToSidecar({type:S.migrateConversationId,data:{oldConversationId:e,newConversationId:t}},3e4)});l(this,"showAgentReview",(e,t,s,r=!0,i)=>{this._asyncMsgSender.sendToSidecar({type:S.chatReviewAgentFile,data:{qualifiedPathName:e,fromTimestamp:t,toTimestamp:s,retainFocus:r,useNativeDiffIfAvailable:i}})});l(this,"acceptAllAgentEdits",async()=>(await this._asyncMsgSender.sendToSidecar({type:S.chatAgentEditAcceptAll}),!0));l(this,"revertToTimestamp",async(e,t)=>(await this._asyncMsgSender.sendToSidecar({type:S.revertToTimestamp,data:{timestamp:e,qualifiedPathNames:t}}),!0));l(this,"getAgentOnboardingPrompt",async()=>(await this._asyncMsgSender.send({type:f.chatGetAgentOnboardingPromptRequest,data:{}},3e4)).data.prompt);l(this,"getAgentEditChangesByRequestId",async e=>{const t={type:S.getEditChangesByRequestIdRequest,data:{requestId:e}};return(await this._asyncMsgSender.sendToSidecar(t,3e4)).data});l(this,"getAgentEditContentsByRequestId",async e=>{const t={type:S.getAgentEditContentsByRequestId,data:{requestId:e}};return(await this._asyncMsgSender.sendToSidecar(t,3e4)).data});l(this,"triggerInitialOrientation",()=>{this._host.postMessage({type:f.triggerInitialOrientation})});l(this,"getWorkspaceInfo",async()=>{try{return(await this._asyncMsgSender.send({type:f.getWorkspaceInfoRequest},5e3)).data}catch(e){return console.error("Error getting workspace info:",e),{}}});l(this,"toggleCollapseUnchangedRegions",()=>{this._host.postMessage({type:f.toggleCollapseUnchangedRegions})});l(this,"checkAgentAutoModeApproval",async()=>(await this._asyncMsgSender.send({type:f.checkAgentAutoModeApproval},5e3)).data);l(this,"setAgentAutoModeApproved",async e=>{await this._asyncMsgSender.send({type:f.setAgentAutoModeApproved,data:e},5e3)});l(this,"checkHasEverUsedAgent",async()=>(await this._asyncMsgSender.sendToSidecar({type:S.checkHasEverUsedAgent},5e3)).data);l(this,"setHasEverUsedAgent",async e=>{await this._asyncMsgSender.sendToSidecar({type:S.setHasEverUsedAgent,data:e},5e3)});l(this,"checkHasEverUsedRemoteAgent",async()=>(await this._asyncMsgSender.sendToSidecar({type:S.checkHasEverUsedRemoteAgent},5e3)).data);l(this,"setHasEverUsedRemoteAgent",async e=>{await this._asyncMsgSender.sendToSidecar({type:S.setHasEverUsedRemoteAgent,data:e},5e3)});l(this,"getChatRequestIdeState",async()=>{const e={type:f.getChatRequestIdeStateRequest};return(await this._asyncMsgSender.send(e,3e4)).data});l(this,"reportError",e=>{this._host.postMessage({type:f.reportError,data:e})});this._host=e,this._asyncMsgSender=t,this._flags=s,this._taskClient=new bs(t)}async*generateCommitMessage(){const e={type:f.generateCommitMessage},t=this._asyncMsgSender.stream(e,3e4,6e4);yield*ve(t,()=>{},this._flags.retryChatStreamTimeouts)}async*sendInstructionMessage(e,t){const s={instruction:e.request_message??"",selectedCodeDetails:t,requestId:e.request_id},r={type:f.chatInstructionMessage,data:s},i=this._asyncMsgSender.stream(r,3e4,6e4);yield*async function*(a){let o;try{for await(const c of a)o=c.data.requestId,yield{request_id:o,response_text:c.data.text,seen_state:A.unseen,status:x.sent};yield{request_id:o,seen_state:A.unseen,status:x.success}}catch{yield{request_id:o,seen_state:A.unseen,status:x.failed}}}(i)}async openGuidelines(e){this._host.postMessage({type:f.openGuidelines,data:e})}async*getExistingChatStream(e,t){if(!e.request_id)return;const s=t==null?void 0:t.flags.enablePreferenceCollection,r=s?1e9:6e4,i=s?1e9:3e5,a={type:f.chatGetStreamRequest,data:{requestId:e.request_id}},o=this._asyncMsgSender.stream(a,r,i);yield*ve(o,this.reportError,this._flags.retryChatStreamTimeouts)}async*startChatStream(e,t){const s=t==null?void 0:t.flags.enablePreferenceCollection,r=s?1e9:1e5,i=s?1e9:3e5,a={type:f.chatUserMessage,data:e},o=this._asyncMsgSender.stream(a,r,i);yield*ve(o,this.reportError,this._flags.retryChatStreamTimeouts)}async checkToolExists(e){return(await this._asyncMsgSender.send({type:f.checkToolExists,toolName:e},0)).exists}async saveImage(e,t){const s=Ye(await fe(e)),r=t??`${await We(await me(s))}.${e.name.split(".").at(-1)}`;return(await this._asyncMsgSender.send({type:f.chatSaveImageRequest,data:{filename:r,data:s}},1e4)).data}async saveAttachment(e,t){const s=Ye(await fe(e)),r=t??`${await We(await me(s))}.${e.name.split(".").at(-1)}`;return(await this._asyncMsgSender.send({type:f.chatSaveAttachmentRequest,data:{filename:r,data:s}},1e4)).data}async loadImage(e){const t=await this._asyncMsgSender.send({type:f.chatLoadImageRequest,data:e},1e4),s=t.data?await me(t.data):void 0;if(!s)return;let r="application/octet-stream";const i=e.split(".").at(-1);i==="png"?r="image/png":i!=="jpg"&&i!=="jpeg"||(r="image/jpeg");const a=new File([s],e,{type:r});return await fe(a)}async deleteImage(e){await this._asyncMsgSender.send({type:f.chatDeleteImageRequest,data:e},1e4)}async*startChatStreamWithRetry(e,t,s){const r=new ys(e,t,(i,a)=>this.startChatStream(i,a),(s==null?void 0:s.maxRetries)??5,4e3,s==null?void 0:s.flags);this._activeRetryStreams.set(e,r);try{yield*r.getStream()}finally{this._activeRetryStreams.delete(e)}}async getSubscriptionInfo(){return await this._asyncMsgSender.send({type:f.getSubscriptionInfo},5e3)}async loadExchanges(e,t){if(t.length===0)return[];const s={type:ye.loadExchangesByUuidsRequest,data:{conversationId:e,uuids:t}};return(await this._asyncMsgSender.sendToSidecar(s,3e4)).data.exchanges}async saveExchanges(e,t){if(t.length===0)return;const s={type:ye.saveExchangesRequest,data:{conversationId:e,exchanges:t}};await this._asyncMsgSender.sendToSidecar(s,3e4)}async deleteConversationExchanges(e){const t={type:ye.deleteConversationExchangesRequest,data:{conversationId:e}};await this._asyncMsgSender.sendToSidecar(t,3e4)}async loadConversationToolUseStates(e){const t={type:be.loadConversationToolUseStatesRequest,data:{conversationId:e}};return(await this._asyncMsgSender.sendToSidecar(t,3e4)).data.toolUseStates}async saveToolUseStates(e,t){if(Object.keys(t).length===0)return;const s={type:be.saveToolUseStatesRequest,data:{conversationId:e,toolUseStates:t}};await this._asyncMsgSender.sendToSidecar(s,3e4)}async deleteConversationToolUseStates(e){const t={type:be.deleteConversationToolUseStatesRequest,data:{conversationId:e}};await this._asyncMsgSender.sendToSidecar(t,3e4)}}async function*ve(n,e=()=>{},t){let s;try{for await(const r of n){if(s=r.data.requestId,r.data.error)return yield{request_id:s,seen_state:A.unseen,status:x.failed,display_error_message:r.data.error.displayErrorMessage,isRetriable:r.data.error.isRetriable,shouldBackoff:r.data.error.shouldBackoff};const i={request_id:s,response_text:r.data.text,workspace_file_chunks:r.data.workspaceFileChunks,structured_output_nodes:ks(r.data.nodes),seen_state:A.unseen,status:x.sent};r.data.stop_reason!=null&&(i.stop_reason=r.data.stop_reason),yield i}yield{request_id:s,seen_state:A.unseen,status:x.success}}catch(r){let i,a;if(e({originalRequestId:s||"",sanitizedMessage:r instanceof Error?r.message:String(r),stackTrace:r instanceof Error&&r.stack||"",diagnostics:[{key:"error_class",value:"Extension-WebView Error"}]}),r instanceof an&&t)switch(r.name){case"MessageTimeout":i=!0,a=!1;break;case"StreamTimeout":case"InvalidResponse":i=!1}yield{request_id:s,seen_state:A.unseen,status:x.failed,isRetriable:i,shouldBackoff:a}}}async function G(n,e){try{return await n}catch(t){return console.warn(`Error while resolving promise: ${t}`),e}}function ks(n){if(!n)return n;let e=!1;return n.filter(t=>t.type!==ln.TOOL_USE||!e&&(e=!0,!0))}const Hs=15,Ks=1e3,ws=25e4;class Vs{constructor(e){l(this,"_enableEditableHistory",!1);l(this,"_enablePreferenceCollection",!1);l(this,"_enableRetrievalDataCollection",!1);l(this,"_enableDebugFeatures",!1);l(this,"_enableConversationDebugUtils",!1);l(this,"_enableRichTextHistory",!1);l(this,"_modelDisplayNameToId",{});l(this,"_fullFeatured",!0);l(this,"_enableExternalSourcesInChat",!1);l(this,"_smallSyncThreshold",15);l(this,"_bigSyncThreshold",1e3);l(this,"_enableSmartPaste",!1);l(this,"_enableDirectApply",!1);l(this,"_summaryTitles",!1);l(this,"_suggestedEditsAvailable",!1);l(this,"_enableShareService",!1);l(this,"_maxTrackableFileCount",ws);l(this,"_enableDesignSystemRichTextEditor",!1);l(this,"_enableSources",!1);l(this,"_enableChatMermaidDiagrams",!1);l(this,"_smartPastePrecomputeMode",on.visibleHover);l(this,"_useNewThreadsMenu",!1);l(this,"_enableChatMermaidDiagramsMinVersion",!1);l(this,"_enablePromptEnhancer",!1);l(this,"_idleNewSessionNotificationTimeoutMs");l(this,"_idleNewSessionMessageTimeoutMs");l(this,"_enableChatMultimodal",!1);l(this,"_enableAgentMode",!1);l(this,"_enableAgentAutoMode",!1);l(this,"_enableRichCheckpointInfo",!1);l(this,"_agentMemoriesFilePathName");l(this,"_conversationHistorySizeThresholdBytes",44040192);l(this,"_userTier","unknown");l(this,"_eloModelConfiguration",{highPriorityModels:[],regularBattleModels:[],highPriorityThreshold:.5});l(this,"_truncateChatHistory",!1);l(this,"_enableBackgroundAgents",!1);l(this,"_enableNewThreadsList",!1);l(this,"_customPersonalityPrompts",{});l(this,"_enablePersonalities",!1);l(this,"_enableRules",!1);l(this,"_memoryClassificationOnFirstToken",!1);l(this,"_enableGenerateCommitMessage",!1);l(this,"_doUseNewDraftFunctionality",!1);l(this,"_modelRegistry",{});l(this,"_enableModelRegistry",!1);l(this,"_enableTaskList",!1);l(this,"_clientAnnouncement","");l(this,"_useHistorySummary",!1);l(this,"_historySummaryMaxChars",0);l(this,"_historySummaryLowerChars",0);l(this,"_historySummaryPrompt","");l(this,"_enableExchangeStorage",!1);l(this,"_enableToolUseStateStorage",!1);l(this,"_retryChatStreamTimeouts",!1);l(this,"_subscribers",new Set);l(this,"subscribe",e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)}));l(this,"update",e=>{this._enableEditableHistory=e.enableEditableHistory??this._enableEditableHistory,this._enablePreferenceCollection=e.enablePreferenceCollection??this._enablePreferenceCollection,this._enableRetrievalDataCollection=e.enableRetrievalDataCollection??this._enableRetrievalDataCollection,this._enableDebugFeatures=e.enableDebugFeatures??this._enableDebugFeatures,this._enableConversationDebugUtils=e.enableConversationDebugUtils??this._enableConversationDebugUtils,this._enableRichTextHistory=e.enableRichTextHistory??this._enableRichTextHistory,this._modelDisplayNameToId={...e.modelDisplayNameToId},this._fullFeatured=e.fullFeatured??this._fullFeatured,this._enableExternalSourcesInChat=e.enableExternalSourcesInChat??this._enableExternalSourcesInChat,this._smallSyncThreshold=e.smallSyncThreshold??this._smallSyncThreshold,this._bigSyncThreshold=e.bigSyncThreshold??this._bigSyncThreshold,this._enableSmartPaste=e.enableSmartPaste??this._enableSmartPaste,this._enableDirectApply=e.enableDirectApply??this._enableDirectApply,this._summaryTitles=e.summaryTitles??this._summaryTitles,this._suggestedEditsAvailable=e.suggestedEditsAvailable??this._suggestedEditsAvailable,this._enableShareService=e.enableShareService??this._enableShareService,this._maxTrackableFileCount=e.maxTrackableFileCount??this._maxTrackableFileCount,this._enableDesignSystemRichTextEditor=e.enableDesignSystemRichTextEditor??this._enableDesignSystemRichTextEditor,this._enableSources=e.enableSources??this._enableSources,this._enableChatMermaidDiagrams=e.enableChatMermaidDiagrams??this._enableChatMermaidDiagrams,this._smartPastePrecomputeMode=e.smartPastePrecomputeMode??this._smartPastePrecomputeMode,this._useNewThreadsMenu=e.useNewThreadsMenu??this._useNewThreadsMenu,this._enableChatMermaidDiagramsMinVersion=e.enableChatMermaidDiagramsMinVersion??this._enableChatMermaidDiagramsMinVersion,this._enablePromptEnhancer=e.enablePromptEnhancer??this._enablePromptEnhancer,this._idleNewSessionMessageTimeoutMs=e.idleNewSessionMessageTimeoutMs??(e.enableDebugFeatures?this._idleNewSessionMessageTimeoutMs??3e5:this._idleNewSessionMessageTimeoutMs),this._idleNewSessionNotificationTimeoutMs=e.idleNewSessionNotificationTimeoutMs??0,this._enableChatMultimodal=e.enableChatMultimodal??this._enableChatMultimodal,this._enableAgentMode=e.enableAgentMode??this._enableAgentMode,this._enableAgentAutoMode=e.enableAgentAutoMode??this._enableAgentAutoMode,this._enableRichCheckpointInfo=e.enableRichCheckpointInfo??this._enableRichCheckpointInfo,this._agentMemoriesFilePathName=e.agentMemoriesFilePathName??this._agentMemoriesFilePathName,this._conversationHistorySizeThresholdBytes=e.conversationHistorySizeThresholdBytes??this._conversationHistorySizeThresholdBytes,this._userTier=e.userTier??this._userTier,this._eloModelConfiguration=e.eloModelConfiguration??this._eloModelConfiguration,this._truncateChatHistory=e.truncateChatHistory??this._truncateChatHistory,this._enableBackgroundAgents=e.enableBackgroundAgents??this._enableBackgroundAgents,this._enableNewThreadsList=e.enableNewThreadsList??this._enableNewThreadsList,this._customPersonalityPrompts=e.customPersonalityPrompts??this._customPersonalityPrompts,this._enablePersonalities=e.enablePersonalities??this._enablePersonalities,this._enableRules=e.enableRules??this._enableRules,this._memoryClassificationOnFirstToken=e.memoryClassificationOnFirstToken??this._memoryClassificationOnFirstToken,this._doUseNewDraftFunctionality=e.doUseNewDraftFunctionality??this._doUseNewDraftFunctionality,this._enableGenerateCommitMessage=e.enableGenerateCommitMessage??this._enableGenerateCommitMessage,this._modelRegistry=e.modelRegistry??this._modelRegistry,this._enableModelRegistry=e.enableModelRegistry??this._enableModelRegistry,this._enableTaskList=e.enableTaskList??this._enableTaskList,this._clientAnnouncement=e.clientAnnouncement??this._clientAnnouncement,this._useHistorySummary=e.useHistorySummary??this._useHistorySummary,this._historySummaryMaxChars=e.historySummaryMaxChars??this._historySummaryMaxChars,this._historySummaryLowerChars=e.historySummaryLowerChars??this._historySummaryLowerChars,this._historySummaryPrompt=e.historySummaryPrompt??this._historySummaryPrompt,this._enableExchangeStorage=e.enableExchangeStorage??this._enableExchangeStorage,this._retryChatStreamTimeouts=e.retryChatStreamTimeouts??this._retryChatStreamTimeouts,this._enableToolUseStateStorage=e.enableToolUseStateStorage??this._enableToolUseStateStorage,this._subscribers.forEach(t=>t(this))});l(this,"isModelIdValid",e=>e!==void 0&&(Object.values(this._modelDisplayNameToId).includes(e)||Object.values(this._modelRegistry).includes(e??"")));l(this,"getModelDisplayName",e=>{if(e!==void 0)return Object.keys(this._modelDisplayNameToId).find(t=>this._modelDisplayNameToId[t]===e)});e&&this.update(e)}get enableEditableHistory(){return this._fullFeatured&&(this._enableEditableHistory||this._enableDebugFeatures)}get enablePreferenceCollection(){return this._enablePreferenceCollection}get enableRetrievalDataCollection(){return this._enableRetrievalDataCollection}get enableDebugFeatures(){return this._enableDebugFeatures}get enableConversationDebugUtils(){return this._enableConversationDebugUtils||this._enableDebugFeatures}get enableGenerateCommitMessage(){return this._enableGenerateCommitMessage}get enableRichTextHistory(){return this._enableRichTextHistory||this._enableDebugFeatures}get modelDisplayNameToId(){return this._modelDisplayNameToId}get orderedModelDisplayNames(){return Object.keys(this._modelDisplayNameToId).sort((e,t)=>{const s=e.toLowerCase(),r=t.toLowerCase();return s==="default"&&r!=="default"?-1:r==="default"&&s!=="default"?1:e.localeCompare(t)})}get fullFeatured(){return this._fullFeatured}get enableExternalSourcesInChat(){return this._enableExternalSourcesInChat}get smallSyncThreshold(){return this._smallSyncThreshold}get bigSyncThreshold(){return this._bigSyncThreshold}get enableSmartPaste(){return this._enableDebugFeatures||this._enableSmartPaste}get enableDirectApply(){return this._enableDirectApply||this._enableDebugFeatures}get enableShareService(){return this._enableShareService}get summaryTitles(){return this._summaryTitles}get suggestedEditsAvailable(){return this._suggestedEditsAvailable}get maxTrackableFileCount(){return this._maxTrackableFileCount}get enableSources(){return this._enableDebugFeatures||this._enableSources}get enableChatMermaidDiagrams(){return this._enableDebugFeatures||this._enableChatMermaidDiagrams}get smartPastePrecomputeMode(){return this._smartPastePrecomputeMode}get useNewThreadsMenu(){return this._useNewThreadsMenu}get enableChatMermaidDiagramsMinVersion(){return this._enableChatMermaidDiagramsMinVersion}get enablePromptEnhancer(){return this._enablePromptEnhancer}get enableDesignSystemRichTextEditor(){return this._enableDesignSystemRichTextEditor}get idleNewSessionNotificationTimeoutMs(){return this._idleNewSessionNotificationTimeoutMs??0}get idleNewSessionMessageTimeoutMs(){return this._idleNewSessionMessageTimeoutMs??0}get enableChatMultimodal(){return this._enableChatMultimodal}get enableAgentMode(){return this._enableAgentMode}get enableAgentAutoMode(){return this._enableAgentAutoMode}get enableRichCheckpointInfo(){return this._enableRichCheckpointInfo}get agentMemoriesFilePathName(){return this._agentMemoriesFilePathName}get conversationHistorySizeThresholdBytes(){return this._conversationHistorySizeThresholdBytes}get userTier(){return this._userTier}get eloModelConfiguration(){return this._eloModelConfiguration}get truncateChatHistory(){return this._truncateChatHistory}get enableBackgroundAgents(){return this._enableBackgroundAgents}get enableNewThreadsList(){return this._enableNewThreadsList}get doUseNewDraftFunctionality(){return this._doUseNewDraftFunctionality}get customPersonalityPrompts(){return this._customPersonalityPrompts}get enablePersonalities(){return this._enablePersonalities||this._enableDebugFeatures}get enableRules(){return this._enableRules}get memoryClassificationOnFirstToken(){return this._memoryClassificationOnFirstToken}get modelRegistry(){return this._modelRegistry}get enableModelRegistry(){return this._enableModelRegistry}get enableTaskList(){return this._enableTaskList}get clientAnnouncement(){return this._clientAnnouncement}get useHistorySummary(){return this._useHistorySummary&&this._historySummaryMaxChars>0}get historySummaryMaxChars(){return this._historySummaryMaxChars}get historySummaryLowerChars(){return this._historySummaryLowerChars}get historySummaryPrompt(){return this._historySummaryPrompt}get enableExchangeStorage(){return this._enableExchangeStorage}get enableToolUseStateStorage(){return this._enableToolUseStateStorage}get retryChatStreamTimeouts(){return this._retryChatStreamTimeouts}get enableErgonomicsUpdate(){return this._enableDebugFeatures}}export{Fs as A,$s as B,Vs as C,Hs as D,js as E,As as F,A as S,Es as U,Os as a,qs as b,x as c,Ls as d,zs as e,ps as f,On as g,Us as h,fs as i,Ks as j,ws as k,Pn as l,Dn as m,Ms as n,Un as o,Bn as p,qn as q,Cs as r,Bs as s,Ln as t,zn as u,jn as v,Ds as w,Ps as x,Rs as y,Ns as z};
