var nt=Object.defineProperty;var lt=(r,t,e)=>t in r?nt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var M=(r,t,e)=>lt(r,typeof t!="symbol"?t+"":t,e);import{S as ct,i as it,s as ut,J as P,f as O,Z as N,_ as X,D as L,X as E,E as j,b as A,c as b,d as I,F as D,K as W,L as G,M as K,h as dt,aa as pt,$ as Z,u as g,q as H,t as f,r as Q,e as B,G as J,W as U,ac as mt,j as ht,T as rt,a0 as ot,a2 as $t,A as Y}from"./SpinnerAugment-CCR7AGk-.js";import{W as gt}from"./IconButtonAugment-CVWbWfwx.js";import"./BaseTextInput-BomIiYnE.js";import{T as ft}from"./TextAreaAugment-20MWk3hd.js";import{l as yt}from"./chevron-down-Di3C5ykp.js";import{R as w,a as Rt}from"./index-DaLJ_QUV.js";const vt=r=>({}),tt=r=>({}),wt=r=>({}),et=r=>({});function st(r){let t,e;return t=new rt({props:{size:1,weight:"light",color:"error",$$slots:{default:[_t]},$$scope:{ctx:r}}}),{c(){j(t.$$.fragment)},m(o,m){D(t,o,m),e=!0},p(o,m){const h={};4194432&m&&(h.$$scope={dirty:m,ctx:o}),t.$set(h)},i(o){e||(g(t.$$.fragment,o),e=!0)},o(o){f(t.$$.fragment,o),e=!1},d(o){J(t,o)}}}function _t(r){let t;return{c(){t=ot(r[7])},m(e,o){b(e,t,o)},p(e,o){128&o&&$t(t,e[7])},d(e){e&&B(t)}}}function at(r){let t,e;return t=new rt({props:{size:1,weight:"light",color:"success",$$slots:{default:[Ft]},$$scope:{ctx:r}}}),{c(){j(t.$$.fragment)},m(o,m){D(t,o,m),e=!0},i(o){e||(g(t.$$.fragment,o),e=!0)},o(o){f(t.$$.fragment,o),e=!1},d(o){J(t,o)}}}function Ft(r){let t;return{c(){t=ot("Saved")},m(e,o){b(e,t,o)},d(e){e&&B(t)}}}function kt(r){let t,e,o,m,h,q,u,k,S,x,$,T,l;const y=r[17].header,d=P(y,r,r[22],et),R=r[17].default,c=P(R,r,r[22],null),_=r[17].title,p=P(_,r,r[22],tt),v=[{variant:r[2]},{size:r[3]},{color:r[4]},{resize:r[5]},{placeholder:"Enter markdown content..."},r[11]];function z(a){r[18](a)}function C(a){r[19](a)}let F={};for(let a=0;a<v.length;a+=1)F=O(F,v[a]);r[0]!==void 0&&(F.textInput=r[0]),r[1]!==void 0&&(F.value=r[1]),u=new ft({props:F}),N.push(()=>X(u,"textInput",z)),N.push(()=>X(u,"value",C)),u.$on("select",r[9]),u.$on("mouseup",r[9]),u.$on("keyup",r[20]),u.$on("input",r[10]),u.$on("keydown",r[21]);let s=!!r[7]&&st(r),i=r[6]&&at(r);return{c(){t=L("div"),e=L("div"),d&&d.c(),o=E(),c&&c.c(),m=E(),h=L("div"),p&&p.c(),q=E(),j(u.$$.fragment),x=E(),$=L("div"),s&&s.c(),T=E(),i&&i.c(),A(e,"class","c-markdown-editor__header svelte-1dcrmc3"),A(h,"class","c-markdown-editor__content svelte-1dcrmc3"),A(t,"class","l-markdown-editor svelte-1dcrmc3"),A($,"class","c-markdown-editor__status svelte-1dcrmc3")},m(a,n){b(a,t,n),I(t,e),d&&d.m(e,null),I(t,o),c&&c.m(t,null),I(t,m),I(t,h),p&&p.m(h,null),I(h,q),D(u,h,null),b(a,x,n),b(a,$,n),s&&s.m($,null),I($,T),i&&i.m($,null),l=!0},p(a,[n]){d&&d.p&&(!l||4194304&n)&&W(d,y,a,a[22],l?K(y,a[22],n,wt):G(a[22]),et),c&&c.p&&(!l||4194304&n)&&W(c,R,a,a[22],l?K(R,a[22],n,null):G(a[22]),null),p&&p.p&&(!l||4194304&n)&&W(p,_,a,a[22],l?K(_,a[22],n,vt):G(a[22]),tt);const V=2108&n?dt(v,[4&n&&{variant:a[2]},8&n&&{size:a[3]},16&n&&{color:a[4]},32&n&&{resize:a[5]},v[4],2048&n&&pt(a[11])]):{};!k&&1&n&&(k=!0,V.textInput=a[0],Z(()=>k=!1)),!S&&2&n&&(S=!0,V.value=a[1],Z(()=>S=!1)),u.$set(V),a[7]?s?(s.p(a,n),128&n&&g(s,1)):(s=st(a),s.c(),g(s,1),s.m($,T)):s&&(H(),f(s,1,1,()=>{s=null}),Q()),a[6]?i?64&n&&g(i,1):(i=at(a),i.c(),g(i,1),i.m($,null)):i&&(H(),f(i,1,1,()=>{i=null}),Q())},i(a){l||(g(d,a),g(c,a),g(p,a),g(u.$$.fragment,a),g(s),g(i),l=!0)},o(a){f(d,a),f(c,a),f(p,a),f(u.$$.fragment,a),f(s),f(i),l=!1},d(a){a&&(B(t),B(x),B($)),d&&d.d(a),c&&c.d(a),p&&p.d(a),J(u),s&&s.d(),i&&i.d()}}}function St(r,t,e){const o=["variant","size","color","resize","textInput","value","selectedText","selectionStart","selectionEnd","saveFunction","debounceValue"];let m,h,q=U(t,o),{$$slots:u={},$$scope:k}=t,{variant:S="surface"}=t,{size:x=2}=t,{color:$}=t,{resize:T="none"}=t,{textInput:l}=t,{value:y=""}=t,{selectedText:d=""}=t,{selectionStart:R=0}=t,{selectionEnd:c=0}=t,{saveFunction:_}=t,{debounceValue:p=2500}=t,v=!1;const z=async()=>{try{_(),e(6,v=!0),clearTimeout(m),m=setTimeout(()=>{e(6,v=!1)},1500)}catch(s){e(7,h=s instanceof Error?s.message:String(s))}};function C(){l&&(e(13,R=l.selectionStart),e(14,c=l.selectionEnd),e(12,d=R!==c?y.substring(R,c):""))}const F=yt.debounce(z,p);return mt(()=>{z()}),r.$$set=s=>{t=O(O({},t),ht(s)),e(11,q=U(t,o)),"variant"in s&&e(2,S=s.variant),"size"in s&&e(3,x=s.size),"color"in s&&e(4,$=s.color),"resize"in s&&e(5,T=s.resize),"textInput"in s&&e(0,l=s.textInput),"value"in s&&e(1,y=s.value),"selectedText"in s&&e(12,d=s.selectedText),"selectionStart"in s&&e(13,R=s.selectionStart),"selectionEnd"in s&&e(14,c=s.selectionEnd),"saveFunction"in s&&e(15,_=s.saveFunction),"debounceValue"in s&&e(16,p=s.debounceValue),"$$scope"in s&&e(22,k=s.$$scope)},[l,y,S,x,$,T,v,h,z,C,F,q,d,R,c,_,p,u,function(s){l=s,e(0,l)},function(s){y=s,e(1,y)},()=>{C()},s=>{(s.key==="Escape"||(s.metaKey||s.ctrlKey)&&s.key==="s")&&(s.preventDefault(),z())},k]}class Bt extends ct{constructor(t){super(),it(this,t,St,kt,ut,{variant:2,size:3,color:4,resize:5,textInput:0,value:1,selectedText:12,selectionStart:13,selectionEnd:14,saveFunction:15,debounceValue:16})}}class Ct{constructor(t){M(this,"_rulesFiles",Y([]));M(this,"_loading",Y(!0));this._msgBroker=t,this.requestRules()}handleMessageFromExtension(t){return!(!t.data||t.data.type!==gt.getRulesListResponse)&&(this._rulesFiles.set(t.data.data),this._loading.set(!1),!0)}async requestRules(){this._loading.set(!0);try{const t=await this._msgBroker.sendToSidecar({type:w.getRulesListRequest,data:{includeGuidelines:!0}});this._rulesFiles.set(t.data.rules)}catch(t){console.error("Failed to get rules list:",t)}finally{this._loading.set(!1)}}async createRule(t){try{const e=await this._msgBroker.sendToSidecar({type:w.createRule,data:{ruleName:t.trim()}});return await this.requestRules(),e.data.createdRule||null}catch(e){throw console.error("Failed to create rule:",e),e}}async getWorkspaceRoot(){try{return(await this._msgBroker.sendToSidecar({type:w.getWorkspaceRoot})).data.workspaceRoot||""}catch(t){return console.error("Failed to get workspace root:",t),""}}async updateRuleContent(t){const e=Rt.formatRuleFileForMarkdown(t);try{await this._msgBroker.sendToSidecar({type:w.updateRuleFile,data:{path:t.path,content:e}})}catch(o){console.error("Failed to update rule file:",o)}await this.requestRules()}async deleteRule(t){try{await this._msgBroker.sendToSidecar({type:w.deleteRule,data:{path:t,confirmed:!0}}),await this.requestRules()}catch(e){throw console.error("Failed to delete rule:",e),e}}async processSelectedPaths(t){try{const e=await this._msgBroker.sendToSidecar({type:w.processSelectedPathsRequest,data:{selectedPaths:t,autoImport:!0}});return await this.requestRules(),{importedRulesCount:e.data.importedRulesCount,directoryOrFile:e.data.directoryOrFile,errors:e.data.errors}}catch(e){throw console.error("Failed to process selected paths:",e),e}}async getAutoImportOptions(){return await this._msgBroker.sendToSidecar({type:w.autoImportRules})}async processAutoImportSelection(t){try{const e=await this._msgBroker.sendToSidecar({type:w.autoImportRulesSelectionRequest,data:{selectedLabel:t.label}});return await this.requestRules(),{importedRulesCount:e.data.importedRulesCount,duplicatesCount:e.data.duplicatesCount,totalAttempted:e.data.totalAttempted,source:e.data.source}}catch(e){throw console.error("Failed to process auto-import selection:",e),e}}getRulesFiles(){return this._rulesFiles}getLoading(){return this._loading}}export{Bt as M,Ct as R};
